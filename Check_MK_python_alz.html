<html>
<head>
  <title>Evernote Export</title>
  <basefont face="맑은 고딕 Semilight" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308474 (ko-KR, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 맑은 고딕 Semilight;
      font-size: 10pt;
    }
  </style>
  
    <link rel="stylesheet" href="style.css">
  
   <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-138982878-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-138982878-1');
</script>


  
</head>
<body>

  <h1><a href="index.html">Check_MK 파이썬 홈페이지 구조 분석</a></h1>
  <div id="grid">
    <ol>
      <li><a href="1.html" class="saw">HTML</a></li>
      <li><a href="2.html" class="saw" id="active">CSS</a></li>
      <li><a href="3.html" >JavasCript</a></li>
      <li><a href="Electromagnetic_wave.html">Electromagnetic wave(전자기파)</a></li>
      <li><a href="Check_MK_python_alz.html">Check_MK Source code 분석(진행중)</a></li>
    </ol>
    <div id="article">
	
	
<a name="16572"/>

<div>
<span><div><span style="font-weight: bold;">Check_MK 파이썬 홈페이지 구조 분석</span></div><div><br/></div><div>Check_MK 화면은 Python, html, css, javascript, jquery, Ajax 등 다양한 기술이 사용되었다.</div><div><br/></div><div>Python 은 서버 Site 에 사용되었고 HTML + CSS + JS 사용해서 브라우저에 동적인 Page 를 구현</div><div><br/></div><div>n. CSS 사용예.</div><div><span style="font-size: 12px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(239, 239, 239); color: rgb(0, 0, 0); font-family: &quot;Malgun Gothic&quot;; font-variant-caps: normal; font-variant-ligatures: normal;"> &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;mystyle.css&quot;&gt;</span></div><div><a href="https://developer.mozilla.org/ko/docs/Learn/CSS/Introduction_to_CSS/How_CSS_works">https://developer.mozilla.org/ko/docs/Learn/CSS/Introduction_to_CSS/How_CSS_works</a></div><div>n. javascript 사용예.</div><div><span style="font-size: 1em; background-color: rgb(238, 238, 238); position: relative; overflow: auto; tab-size: 4; box-sizing: border-box; width: 632px; max-width: 100%; text-shadow: none; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: normal; counter-reset: linenumber 0; letter-spacing: -0.04448px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; -webkit-text-stroke-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-radius: 2px; background-position: 0px 0px; border-right-width: 0px !important; direction: ltr !important; color: rgb(153, 153, 153); font-family: Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">&lt;</span><span style="font-size: 1em; background-color: rgb(238, 238, 238); position: relative; overflow: auto; tab-size: 4; box-sizing: border-box; width: 632px; max-width: 100%; text-shadow: none; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: normal; counter-reset: linenumber 0; letter-spacing: -0.04448px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; -webkit-text-stroke-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-radius: 2px; background-position: 0px 0px; border-right-width: 0px !important; direction: ltr !important; color: rgb(153, 0, 85); font-family: Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">script</span> <span style="font-size: 1em; background-color: rgb(238, 238, 238); position: relative; overflow: auto; tab-size: 4; box-sizing: border-box; width: 632px; max-width: 100%; text-shadow: none; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: normal; counter-reset: linenumber 0; letter-spacing: -0.04448px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; -webkit-text-stroke-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-radius: 2px; background-position: 0px 0px; border-right-width: 0px !important; direction: ltr !important; color: rgb(102, 153, 0); font-family: Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">src</span><span style="font-size: 1em; background-color: rgb(238, 238, 238); position: relative; overflow: auto; tab-size: 4; box-sizing: border-box; width: 632px; max-width: 100%; text-shadow: none; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: normal; counter-reset: linenumber 0; letter-spacing: -0.04448px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; -webkit-text-stroke-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-radius: 2px; background-position: 0px 0px; border-right-width: 0px !important; direction: ltr !important; color: rgb(153, 153, 153); font-family: Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">=</span><span style="font-size: 1em; background-color: rgb(238, 238, 238); position: relative; overflow: auto; tab-size: 4; box-sizing: border-box; width: 632px; max-width: 100%; text-shadow: none; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: normal; counter-reset: linenumber 0; letter-spacing: -0.04448px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; -webkit-text-stroke-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-radius: 2px; background-position: 0px 0px; border-right-width: 0px !important; direction: ltr !important; color: rgb(153, 153, 153); font-family: Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">&quot;</span><span style="font-size: 1em; background-color: rgb(238, 238, 238); position: relative; overflow: auto; tab-size: 4; box-sizing: border-box; width: 632px; max-width: 100%; text-shadow: none; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: normal; counter-reset: linenumber 0; letter-spacing: -0.04448px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; -webkit-text-stroke-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-radius: 2px; background-position: 0px 0px; border-right-width: 0px !important; direction: ltr !important; color: rgb(0, 119, 170); font-family: Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">script.js</span><span style="font-size: 1em; background-color: rgb(238, 238, 238); position: relative; overflow: auto; tab-size: 4; box-sizing: border-box; width: 632px; max-width: 100%; text-shadow: none; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: normal; counter-reset: linenumber 0; letter-spacing: -0.04448px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; -webkit-text-stroke-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-radius: 2px; background-position: 0px 0px; border-right-width: 0px !important; direction: ltr !important; color: rgb(153, 153, 153); font-family: Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">&quot;</span><span style="font-size: 1em; background-color: rgb(238, 238, 238); position: relative; overflow: auto; tab-size: 4; box-sizing: border-box; width: 632px; max-width: 100%; text-shadow: none; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: normal; counter-reset: linenumber 0; letter-spacing: -0.04448px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; -webkit-text-stroke-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-radius: 2px; background-position: 0px 0px; border-right-width: 0px !important; direction: ltr !important; color: rgb(153, 153, 153); font-family: Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">&gt;</span><span style="font-size: 1em; background-color: rgb(238, 238, 238); position: relative; overflow: auto; tab-size: 4; box-sizing: border-box; width: 632px; max-width: 100%; text-shadow: none; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: normal; counter-reset: linenumber 0; letter-spacing: -0.04448px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; -webkit-text-stroke-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-radius: 2px; background-position: 0px 0px; border-right-width: 0px !important; direction: ltr !important; color: rgb(153, 153, 153); font-family: Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">&lt;/</span><span style="font-size: 1em; background-color: rgb(238, 238, 238); position: relative; overflow: auto; tab-size: 4; box-sizing: border-box; width: 632px; max-width: 100%; text-shadow: none; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: normal; counter-reset: linenumber 0; letter-spacing: -0.04448px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; -webkit-text-stroke-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-radius: 2px; background-position: 0px 0px; border-right-width: 0px !important; direction: ltr !important; color: rgb(153, 0, 85); font-family: Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">script</span><span style="font-size: 1em; background-color: rgb(238, 238, 238); position: relative; overflow: auto; tab-size: 4; box-sizing: border-box; width: 632px; max-width: 100%; text-shadow: none; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: normal; counter-reset: linenumber 0; letter-spacing: -0.04448px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; -webkit-text-stroke-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-radius: 2px; background-position: 0px 0px; border-right-width: 0px !important; direction: ltr !important; color: rgb(153, 153, 153); font-family: Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">&gt;</span></div><div><br/></div><div><span style="font-weight: bold;">n. OMD 가 사용하는 Apache config file</span></div><div>- 실행중인 httpd 프로세스 옵션에서 apache config 파일 확인</div><div>- error_log 에서 mod_python/3.3.1 확인</div><div><br/></div><div>ps -ef |grep http</div><div>sjopen   54273 30208  0 00:01 ?        00:00:11 /usr/sbin/httpd -f /omd/sites/sjopen/etc/apache/apache.conf</div><div><br/></div><div># cat /omd/sites/sjopen/var/log/apache/error_log</div><div>Apache/2.4.6 (CentOS) mod_python/3.3.1 Python/2.7.14 mod_fcgid/2.3.9 configured</div><div><br/></div><div>n. apache.conf  설정 분석</div><div># vi /omd/sites/sjopen/etc/apache/apache.conf</div><div>DocumentRoot &quot;/omd/sites/sjopen/var/www&quot;                 ==&gt; Public document root, 실제 파일은 하나도 없음</div><div>Include /omd/sites/sjopen/etc/apache/listen-port.conf    ==&gt; Listen 127.0.0.1:5000</div><div><br/></div><div>Include /omd/sites/sjopen/etc/apache/conf.d/*.conf        ==&gt; 추가적인 Configuration 파일들은 별도 파일에서 include</div><div><br/></div><div>ls /omd/sites/sjopen/etc/apache/conf.d/*.conf</div><div>/omd/sites/sjopen/etc/apache/conf.d/01_python.conf     ==&gt; <span style="color: rgb(255, 0, 0);">LoadModule python_module  mod_python.so 파이썬 모듈 apache 에 로드</span></div><div>/omd/sites/sjopen/etc/apache/conf.d/02_fcgid.conf</div><div>/omd/sites/sjopen/etc/apache/conf.d/auth.conf               ==&gt; AuthUserFile /omd/sites/sjopen/etc/htpasswd</div><div>/omd/sites/sjopen/etc/apache/conf.d/check_mk.conf      ==&gt; <font style="color: rgb(255, 0, 0);">Alias /</font><span style="color: rgb(227, 0, 0);">sjopen/check_mk</span>   /omd/sites/sjopen/share/check_mk/web/htdocs, <span style="color: rgb(227, 0, 0);">메인 Site 설정</span></div><div>/omd/sites/sjopen/etc/apache/conf.d/cookie_auth.conf</div><div>/omd/sites/sjopen/etc/apache/conf.d/dokuwiki.conf</div><div>/omd/sites/sjopen/etc/apache/conf.d/icinga.conf</div><div>/omd/sites/sjopen/etc/apache/conf.d/nagios.conf</div><div>/omd/sites/sjopen/etc/apache/conf.d/nagvis.conf</div><div>/omd/sites/sjopen/etc/apache/conf.d/omd.conf</div><div>/omd/sites/sjopen/etc/apache/conf.d/pnp4nagios.conf</div><div>/omd/sites/sjopen/etc/apache/conf.d/site.conf</div><div>/omd/sites/sjopen/etc/apache/conf.d/stats.conf</div><div>/omd/sites/sjopen/etc/apache/conf.d/var_www.conf        =&gt; <span style="color: rgb(227, 0, 0);">Alias /sjopen &quot;/omd/sites/sjopen/var/www&quot; =&gt; public document root 설정</span></div><div> </div><div>N. /omd/sites/sjopen/etc/apache/conf.d/*.conf  파일 분석</div><div><br/></div><div><span style="font-weight: bold;">n. mod_python 모듈 Apache 에 추가하기</span></div><div>/omd/sites/sjopen/etc/apache/conf.d/01_python.conf</div><div>&lt;IfModule !mod_python.c&gt;</div><div>  LoadModule python_module /omd/sites/sjopen/lib/apache/modules/mod_python.so</div><div>&lt;/IfModule&gt;</div><div>   # Mod_python is an Apache module that embeds the Python interpreter within the server.</div><div><br/></div><div><a href="http://modpython.org/live/mod_python-3.3.1/doc-html/tut-what-it-do.html">http://modpython.org/live/mod_python-3.3.1/doc-html/tut-what-it-do.html</a></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">n. mod_python 핸들러</span></div><div>- Apache는 일반적인 요청을 3단계 phase로 나줘서 처리한다. (1) translate the requested URI to a file location (2) read the file and send it to the client, then (3) log the request. </div><div>- Apache가 처리하는 하나의 단계를 &quot;핸들러(handler)&quot;라고 한다.</div><div>- 특별한 처리가 필요한 요청은 additional handler 를 통해서 처리할 수 있다.</div><div>- mod_python 자체는 아무것도 하지 않지만 Python* 으로 시작하고 Handler로 끝나는 설정을 통해서 원하는 동작을 할 수 있다.</div><div>- PythonHandler 는 이름이 없는 핸들러이며 generic handler 라고 부른다.</div><div>- AddHandler 설정은 .py 확장자로 끝나는 요청은 mod_python handler 로 처리해야 한다는 설정</div><div>- PythonHandler 설정은 /sjopen/check_mk/*.py 확장자로 들어오는 요청은 generic handler 처리를 index.py로 처리한다는 의미</div><div>- *.py 로 들어오는 요청은 index.py 내부 handler() 함수가 generic handler로써 호출하고 request object 를 전달한다.(파일 존재 여부와 관계없다)</div><div>- request object (req) 는 http 요청에 대한 모든 정보를 가지고 있다.(client IP, header, URI, etc) </div><div><br/></div><div>&gt; <a href="http://modpython.org/live/current/doc-html/tutorial.html">http://modpython.org/live/current/doc-html/tutorial.html</a></div><div><br/></div><div><img src="Check_MK_python_alz_files/Image.gif" type="image/gif" data-filename="Image.gif" title="눌러서 다운로드" width="572"/>  <img src="Check_MK_python_alz_files/Image [1].gif" type="image/gif" data-filename="Image.gif" title="눌러서 다운로드" width="490"/></div><div><br/></div><div><a href="http://modpython.org/live/mod_python-3.3.1/doc-html/tut-what-it-do.html">http://modpython.org/live/mod_python-3.3.1/doc-html/tut-what-it-do.html</a></div><div><br/></div><div><span style="font-weight: bold;">n. mod_python 핸들러 설정(/sjopen/check_mk 경로에 대한)</span></div><div><br/></div><div>/omd/sites/sjopen/etc/apache/conf.d/check_mk.conf</div><div>  Alias /sjopen/check_mk /omd/sites/sjopen/share/check_mk/web/htdocs</div><div>  &lt;Directory /omd/sites/sjopen/share/check_mk/web/htdocs&gt;</div><div><span style="color: rgb(28, 51, 135);">        AddHandler mod_python .py</span>          ==&gt; py로 끝나는 파일은 mod_python 으로 처리한다는 지시어</div><div><span style="color: rgb(45, 79, 201);">        Python</span><font style="color: rgb(227, 0, 0);">Handler</font> <span style="color: rgb(45, 79, 201);">index</span><span style="color: rgb(45, 79, 201);"> </span>                     <span style="color: rgb(255, 0, 0);">==&gt;</span> <span style="color: rgb(255, 0, 0);">main request handler, index 모듈 임포트, </span><span style="color: rgb(255, 0, 0);">index.py 모듈에서 handler 함수를 호출</span></div><div><span style="color: rgb(255, 0, 0);">                                                                       (</span><span style="color: rgb(255, 0, 0);">PythonHandler -&gt; handler), handler 호출 및 </span><span style="color: rgb(255, 0, 0);">request object 전달</span></div><div>        PythonOption mod_python.importer.path &quot;['/omd/sites/sjopen/local/share/check_mk/web/htdocs', '/omd/sites/sjopen/share/check_mk/web/htdocs']&quot; </div><div>                                                                <span style="color: rgb(255, 0, 0);">==&gt; </span><span style="color: rgb(255, 0, 0);">모듈을 검색하는 순서,</span> <span style="color: rgb(255, 0, 0);">apache.import_module() function is called with just the name of the module.</span></div><div>        DirectoryIndex index.py                  ==&gt; 클라이언트가 디렉토리를 요청할때 찾아볼 자원</div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">n. index.py 파일 handler 분석</span></div><div><span style="font-weight: bold;">(PythonHandler index 에 의해서 호출되는 파일)</span></div><div><br/></div><div>/omd/sites/sjopen/share/check_mk/web/htdocs/index.py</div><div><span style="font-family: 바탕체;">#!/usr/bin/python</span></div><div><span style="font-family: 바탕체;">-*- encoding: utf-8; py-indent-offset: 4 -*-</span></div><div><span style="font-family: 바탕체;"># +------------------------------------------------------------------+</span></div><div><span style="font-family: 바탕체;"># |             ____ _               _        __  __ _  __           |</span></div><div><span style="font-family: 바탕체;"># |            / ___| |__   ___  ___| | __   |  \/  | |/ /           |</span></div><div><span style="font-family: 바탕체;"># |           | |   | '_ \ / _ \/ __| |/ /   | |\/| | ' /            |</span></div><div><span style="font-family: 바탕체;"># |           | |___| | | |  __/ (__|   &lt;    | |  | | . \            |</span></div><div><span style="font-family: 바탕체;"># |            \____|_| |_|\___|\___|_|\_\___|_|  |_|_|\_\           |</span></div><div><span style="font-family: 바탕체;"># |                                                                  |</span></div><div><span style="font-family: 바탕체;"># | Copyright Mathias Kettner 2014             </span><a dir="ltr" href="mailto:mk@mathias-kettner.de" style="font-family: 바탕체;">mk@mathias-kettner.de</a> <span style="font-family: 바탕체;">|</span></div><div><span style="font-family: 바탕체;"># +------------------------------------------------------------------+</span></div><div><br/></div><div><span style="font-family: 바탕체;">from mod_python import apache</span></div><div><span style="font-family: 바탕체;">import sys, os, pprint,</span> <span style="color: rgb(255, 0, 0); font-family: 바탕체;">__builtin__</span><span style="font-family: 바탕체;">    ==&gt; 파이썬 표준 라이브러리에 포함된 모듈, </span><span style="font-family: 바탕체;"><span style="font-family: 바탕체; font-weight: bold;">__builtin__</span> </span><span style="font-family: 바탕체;">module provides direct access to all‘built-in’identifiers of Python</span></div><div><span style="font-family: 바탕체;">import traceback                       </span><span style="font-family: 바탕체;">==&gt; 파이썬 표준 라이브러리에 포함된 모듈</span></div><div><br/></div><div><span style="font-family: &quot;맑은 고딕&quot;;">#  Check_MK 에서 설치한 파이썬 모듈 및 함수들 임포트 (/omd/sites/sjopen/share/check_mk/web/htdocs 아래)</span></div><div><span style="font-family: 바탕체;">import i18n</span></div><div><span style="font-family: 바탕체;">import sites</span></div><div><span style="font-family: 바탕체;">import livestatus</span></div><div><span style="font-family: 바탕체;">import modules</span></div><div><span style="font-family: 바탕체;">import userdb</span></div><div><span style="font-family: 바탕체;">import config</span></div><div><span style="font-family: 바탕체;">import login</span></div><div><span style="font-family: 바탕체;">from lib import *</span></div><div><span style="font-family: 바탕체;">import log</span></div><div><span style="font-family: 바탕체;">from html_mod_python import html_mod_python, FinalizeRequest</span></div><div><span style="font-family: 바탕체;">import cmk.paths     ==&gt; </span><span style="font-family: 바탕체;">/opt/omd/versions/1.5.0p13.cre/lib/python/cmk/paths.py</span></div><div><br/></div><div><span style="font-family: 바탕체;"># Main entry point for all HTTP-requests (called directly by mod_apache)</span></div><div><span style="color: rgb(255, 0, 0); font-family: 바탕체;"><span style="color: rgb(255, 0, 0); font-family: 바탕체; font-weight: bold;">def handler(mod_python_req, fields = None, is_profiling = False):</span>  ==&gt;  </span><span style="color: rgb(255, 0, 0); font-family: &quot;맑은 고딕&quot;; font-weight: bold;">.py </span><span style="color: rgb(255, 0, 0); font-family: &quot;맑은 고딕&quot;; font-weight: bold;">핸들러가 호출하는 함수 </span><span style="color: rgb(255, 0, 0); font-family: &quot;맑은 고딕&quot;; font-weight: bold;">handler</span> <span style="color: rgb(255, 0, 0); font-family: &quot;맑은 고딕&quot;; font-weight: bold;">(&quot;PythonHandler&quot; 에서 Python 빼고 &quot;handler&quot;가 호출됨)</span></div><div><span style="font-family: 바탕체;">    # Create an object that contains all data about the request and</span></div><div><span style="font-family: 바탕체;">    # helper functions for creating valid HTML. Parse URI and</span></div><div><span style="font-family: 바탕체;">    # store results in the request object for later usage.</span></div><div><span style="font-family: 바탕체;">    </span><span style="color: rgb(255, 0, 0); font-family: 바탕체;">__builtin__.html = html_mod_python(mod_python_req, fields)</span><span style="font-family: 바탕체;">     ==&gt; html 인스턴스 생성 </span><span style="font-size: 10pt; font-family: &quot;맑은 고딕&quot;;">html_mod_python </span><a href="https://edu.goorm.io/learn/lecture/202/%EB%B0%94%EB%A1%9C-%EC%8B%A4%ED%96%89%ED%95%B4%EB%B3%B4%EB%A9%B4%EC%84%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%ED%8C%8C%EC%9D%B4%EC%8D%AC/lesson/26672/%ED%81%B4%EB%9E%98%EC%8A%A4%EB%9E%80" style="font-size: 10pt; font-family: &quot;맑은 고딕&quot;;">클래스</a><span style="font-size: 10pt; font-family: &quot;맑은 고딕&quot;;"> (html 클래스 상속)</span></div><div><br/></div><div><span style="font-family: 바탕체;">    response_code = apache.OK</span></div><div><span style="font-family: 바탕체;">    try:</span></div><div><span style="font-family: 바탕체;">        config.initialize()    <span style="font-family: 바탕체; color: rgb(255, 0, 0);">==&gt; </span></span><span style="color: rgb(255, 0, 0); font-family: 바탕체;">multisite.mk 및</span> <span style="color: rgb(255, 0, 0); font-family: 바탕체;">multisite.d/*.mk 불러옴(include)</span></div><div><span style="font-family: 바탕체;">        init_profiling(is_profiling)</span></div><div><span style="font-family: 바탕체;">        html.init_modes()      <span style="font-family: 바탕체; color: rgb(227, 0, 0);">==&gt; </span></span><span style="color: rgb(227, 0, 0); font-family: 바탕체;">Initializes the operation mode of the html() object.</span></div><div><br/></div><div><span style="font-family: 바탕체;">        # Make sure all plugins are avaiable as early as possible. At least</span></div><div><span style="font-family: 바탕체;">        # we need the plugins (i.e. the permissions declared in these) at the</span></div><div><span style="font-family: 바탕체;">        # time before the first login for generating auth.php.</span></div><div><span style="font-family: 바탕체;">        modules.load_all_plugins()</span></div><div><br/></div><div><span style="font-family: 바탕체;">        # Get page handler.</span></div><div><span style="color: rgb(227, 0, 0); font-family: 바탕체;">        handler = modules.get_handler(html.myfile, page_not_found)  ==&gt; myfile(확장자 뺀 filename) 를 key로 딕셔너리에서 추출, 없으면 page_not_found</span></div><div><span style="color: rgb(227, 0, 0); font-family: 바탕체;">                                                                    ==&gt; </span><span style="color: rgb(227, 0, 0); font-family: 바탕체;">pagehandlers 딕셔너리는 다른 단계에서 색인해서 만드는것 같음</span></div><div><br/></div><div><span style="font-family: 바탕체;">        # Some pages do skip authentication. This is done by adding</span></div><div><span style="font-family: 바탕체;">        # noauth: to the page hander, e.g. &quot;noauth:run_cron&quot; : ...</span></div><div><span style="font-family: 바탕체;">        # TODO: Eliminate those &quot;noauth:&quot; pages. Eventually replace it by call using</span></div><div><span style="font-family: 바탕체;">        #       the now existing default automation user.</span></div><div><span style="font-family: 바탕체;">        if handler == page_not_found:                                                  <span style="font-family: 바탕체; color: rgb(255, 0, 0);">==&gt; page_not_found 발생하면 noauth 방식으로 재시도</span></span></div><div><span style="font-family: 바탕체;">            handler = modules.get_handler(&quot;noauth:&quot; + html.myfile, page_not_found)</span></div><div><span style="font-family: 바탕체;">            if handler != page_not_found:</span></div><div><span style="font-family: 바탕체;">                try:</span></div><div><span style="font-family: 바탕체;">                    <span style="font-family: 바탕체; color: rgb(255, 0, 0);">handler()    ==&gt; URL 에서 호출한 핸들러 실행(EX: view)</span></span></div><div><span style="font-family: 바탕체;">                except Exception, e:</span></div><div><span style="font-family: 바탕체;">                    html.write_text(&quot;%s&quot; % e)</span></div><div><span style="font-family: 바탕체;">                    if config.debug:</span></div><div><span style="font-family: 바탕체;">                        html.write_text(traceback.format_exc())</span></div><div><span style="font-family: 바탕체;">                raise FinalizeRequest()</span></div><div><span style="font-family: 바탕체; font-weight: bold;">&lt;생략&gt;</span></div><div><span style="font-family: 바탕체;">        # All plugins might have to be reloaded due to a language change. Only trigger</span></div><div><span style="font-family: 바탕체;">        # a second plugin loading when the user is really using a custom localized GUI.</span></div><div><span style="font-family: 바탕체;">        # Otherwise the load_all_plugins() at the beginning of the request is sufficient.</span></div><div><span style="font-family: 바탕체;">        if i18n.get_current_language() != previous_language:</span></div><div><span style="font-family: 바탕체;">            modules.load_all_plugins()</span></div><div><br/></div><div><span style="font-family: 바탕체;">        ensure_general_access()</span></div><div><span style="color: rgb(255, 0, 0); font-family: 바탕체;">        handler()</span></div><div><br/></div><div><span style="font-family: 바탕체;">        # Get page handler.</span></div><div><span style="font-family: 바탕체;">        handler = modules.get_handler(html.myfile, page_not_found)  ==&gt;  </span><span style="font-family: 바탕체;">return pagehandlers.get(name, dflt)</span></div><div><br/></div><div><span style="font-family: 바탕체; font-weight: bold;">&lt;생략&gt;</span></div><div><br/></div><div><span style="font-family: 바탕체;"># Early initialization upon first start of the application by the server</span></div><div><span style="font-family: 바탕체;">def initialize():</span></div><div><span style="font-family: 바탕체;">    init_sys_path()</span></div><div><span style="font-family: 바탕체;">    log.init_logging()      ==&gt; </span><span style="font-family: 바탕체;">web.log 에 기록하도록 logger를 초기화 하는 것 같음(</span><span style="font-family: 바탕체;">/opt/omd/sites/sjopen/var/log/web.log)</span></div><div><span style="font-family: 바탕체;">    modules.init_modules()  ==&gt; </span><span style="font-family: 바탕체;">modules.py 모듈에 </span><span style="font-family: 바탕체;">init_modules 펑션 정의됨: </span><span style="font-family: 바탕체;">Loads all modules needed into memory and performs global initializations</span></div><div><br/></div><div><span style="font-family: 바탕체;"># Run the global application initialization code here. It is called</span></div><div><span style="font-family: 바탕체;"># only once during the startup of the application server.</span></div><div><span style="font-family: 바탕체;">initialize()</span></div><div><br/></div><div><span style="font-family: 바탕체;"># Early initialization 분석</span></div><div><span style="font-family: 바탕체;">index.py -&gt; initialize() -&gt; modules.py -&gt; init_modules -&gt; </span><span style="font-family: 바탕체;">load_web_plugins('pages', globals())</span><span style="font-family: 바탕체;"> -&gt;</span><span style="font-family: 바탕체;"> </span>lib.py -&gt; <span style="font-family: 바탕체;">load_web_plugins(forwhat, globalvars):</span><span style="font-family: 바탕체;"> -&gt; </span><span style="font-family: 바탕체;">&quot;/plugins/pages&quot;</span><span style="font-family: 바탕체;"> 파일을</span> <span style="font-family: 바탕체;">execfile() 하는것같음(</span><a href="evernote:///view/4527709/s42/a4f95732-6f9e-452e-bbbe-18e7d67e37b2/a4f95732-6f9e-452e-bbbe-18e7d67e37b2/" style="font-family: 바탕체;">따로분석하자</a><span style="font-family: 바탕체;">)</span></div><div><br/></div><div><span style="font-weight: bold;">n. 접속화면 분석</span></div><div>/sjopen/check_mk/ 접속하면 자동으로 index.py 옵션으로 start_url=dashboard.py 호출됨</div><div><a dir="ltr" href="http://172.16.30.93/sjopen/check_mk/index.py?start_url=%2Fsjopen%2Fcheck_mk%2Fdashboard.py">http://172.16.30.93/sjopen/check_mk/index.py?start_url=%2Fsjopen%2Fcheck_mk%2Fdashboard.py</a></div><div><img src="Check_MK_python_alz_files/Image.png" type="image/png" data-filename="Image.png" title="눌러서 다운로드" width="854"/></div><div><br/></div><div><a href="http://172.16.30.93/sjopen/check_mk/view.py?view_name=allhosts">http://172.16.30.93/sjopen/check_mk/view.py?view_name=allhosts</a></div><div><a href="http://172.16.30.93/sjopen/check_mk/view.py?host=sjopen1&amp;site=sjopen&amp;view_name=host">http://172.16.30.93/sjopen/check_mk/view.py?host=sjopen1&amp;site=sjopen&amp;view_name=host</a></div><div><br/></div><div><br/></div><div>n. CSS 는 어떻게 불러오나?</div><div>- 브라우저에서 확인한 CSS 경로는 다음과 같다.</div><div>     <a href="http://172.16.30.93/sjopen/check_mk/check_mk-1.4.0p33.css">http://172.16.30.93/sjopen/check_mk/check_mk-1.4.0p33.css</a> </div><div>- 실제 파일 이름은 check_mk.css 인데 check_mk-1.4.0p33.css 로 변경되서 불러온다.</div><div>- 아래 모듈에서 css_filename_for_browser 함수에서 파일명에 버전 정보를 넣어서 반환 하는것 같다.</div><div>- css_filename_for_browser 함수는 htmllib.py 와 html_mod_python.py 2곳에서 정의되었다.</div><div><br/></div><div># vi /omd/sites/sjopen/share/check_mk/web/htdocs/html_mod_python.py</div><div><br/></div><div>    def css_filename_for_browser(self, css):</div><div><span style="color: rgb(255, 0, 0);">        rel_path = &quot;/share/check_mk/web/htdocs/&quot; + css + &quot;.css&quot;</span></div><div>        if os.path.exists(cmk.paths.omd_root + rel_path) or \</div><div>            os.path.exists(cmk.paths.omd_root + &quot;/local&quot; + rel_path):</div><div>            <span style="color: rgb(227, 0, 0);">return '%s-%s.css' % (css, cmk.__version__)</span></div><div><br/></div><div><br/></div><div><br/></div><div>/omd/sites/sjopen/share/check_mk/web/htdocs/html_mod_python.py</div><div>       =&gt; Request 를 분석하고 URL 분석해서 page name 확인하는 기능? We strip away the .py and get the name of the page., 모바일, degug</div><div>       =&gt;  def javascript_filename_for_browser(self, jsname):</div><div>/omd/sites/sjopen/share/check_mk/web/htdocs/htmllib.py   =&gt; <span style="color: rgb(227, 0, 0);">HTML encoding, def html_head(), def body_start() HTML 문서 만드는 Class, 함수들</span></div><div>/omd/sites/sjopen/share/check_mk/web/htdocs/views.py</div><div>[root@dev93 htdocs]# ls -l *html*</div><div>-rw-r--r--. 1 root root 102263 May 17  2018 htmllib.py</div><div>-rw-r--r--. 1 root root  12250 May 17  2018 html_mod_python.py</div><div><br/></div><div><br/></div><div><br/></div><div><a href="http://math.uni.lodz.pl/~kowalcr/SLWP/Python3/CGI%20scripts%20in%20Python%20and%20mod_python.pdf">http://math.uni.lodz.pl/~kowalcr/SLWP/Python3/CGI%20scripts%20in%20Python%20and%20mod_python.pdf</a></div><div>What is Mod_python?</div><div>Apache module that embeds the Pyhton interpreter</div><div><br/></div><div>Notepad++ 로 파이썬 개발 및 실행하기</div><div><a href="https://guslabview.tistory.com/344">https://guslabview.tistory.com/344</a></div><div><br/></div><div>mod_python 공식 온라인 메뉴얼</div><div><a href="http://modpython.org/live/mod_python-3.3.1/doc-html/module-apache.html">http://modpython.org/live/mod_python-3.3.1/doc-html/module-apache.html</a></div><div><br/></div><div>Mod python notes</div><div><a href="https://helpful.knobs-dials.com/index.php/Mod_python_notes">https://helpful.knobs-dials.com/index.php/Mod_python_notes</a></div><div><br/></div><div><span style="font-weight: bold;">Apache와 Python 연동하기(한글)</span></div><div><a href="https://blog.ayukawa.kr/archives/1342">https://blog.ayukawa.kr/archives/1342</a></div><div><br/></div><div>mod_python 핸들러 설명 &gt; PythonHandler</div><div><a href="https://m.blog.naver.com/PostView.nhn?blogId=mtjeaids&amp;logNo=70081082872&amp;proxyReferer=https%3A%2F%2Fwww.google.com%2F">https://m.blog.naver.com/PostView.nhn?blogId=mtjeaids&amp;logNo=70081082872&amp;proxyReferer=https%3A%2F%2Fwww.google.com%2F</a></div><div><br/></div><div>파이썬 표준 라이브러리 - 어떤것이 있는지 찾아본다.</div><div><a href="https://docs.python.org/3/library/">https://docs.python.org/3/library/</a></div><div><br/></div><div>표준은 아니지만 쓸만한 파이썬 패키지 검색, Find, install and publish Python packages with the Python Package Index</div><div>설치는 pip, setuptools, wheel 사용</div><div><a href="https://pypi.org/">https://pypi.org/</a></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">n. OMD public page 에서 mod_python 사용하도록 설정해보기 테스트 -&gt; OK</span></div><div>vi /omd/sites/sjopen/etc/apache/conf.d/var_www.conf</div><div>Alias /sjopen &quot;/omd/sites/sjopen/var/www&quot;</div><div>&lt;Directory /omd/sites/sjopen/var/www&gt;</div><div>    Options +Indexes +FollowSymlinks</div><div># sjjslee 2019.04.10 for test</div><div>        AddHandler mod_python .py</div><div>        PythonHandler index</div><div>        DirectoryIndex index.py</div><div># sjlslee</div><div>&lt;/Directory&gt;</div><div><br/></div><div><span style="font-weight: bold;">n. mod_python 테스트 프로그램 -&gt; OK</span></div><div># vi /omd/sites/sjopen/var/www/index.py</div><div>from mod_python import apache    # 모든 mod_python 프로그램 필요, 함수명 만으로 모듈내부 함수를 사용하도록 모듈 임포트</div><div>                                                        # mod_python 패키지의 apache 모듈, Apache interal 접근을 위한 인터페이스(m<a href="http://modpython.org/live/mod_python-3.3.1/doc-html/module-apache.html">od_python manual</a>)</div><div>def handler(req):</div><div>    req.send_http_header()</div><div>    req.write(&quot;Hello World!\n&quot;)</div><div>    req.write(&quot;req.connection %s\n&quot; % req.connection)</div><div>    req.write(&quot;req.server %s\n&quot; % req.server)</div><div>    req.write(&quot;req.interpreter %s\n&quot; % req.interpreter)</div><div>    return apache.OK</div><div><br/></div><div><img src="Check_MK_python_alz_files/Image [1].png" type="image/png" data-filename="Image.png" title="눌러서 다운로드" width="508"/></div><div><br/></div><div><a href="https://wikidocs.net/29">https://wikidocs.net/29</a>   =&gt; 모듈 사용법</div><div><br/></div><div><br/></div><div>Ajax(Asynchronous JavaScript and XML) 구조</div><div><img src="Check_MK_python_alz_files/Image [2].png" type="image/png" data-filename="Image.png" title="눌러서 다운로드"/> <img src="Check_MK_python_alz_files/Image.jpg" type="image/jpeg" data-filename="Image.jpg" title="눌러서 다운로드"/></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">n. index.py 파일 handler 분석</span></div><div><span style="font-weight: bold;">(PythonHandler index 에 의해서 호출되는 파일)</span></div><div><br/></div><div># vi /omd/sites/sjopen/share/check_mk/web/htdocs/index.py</div><div><br/></div><div>from mod_python import apache</div><div>def <span style="color: rgb(255, 0, 0);">handler</span>(req):           ==&gt; <span style="color: rgb(255, 0, 0);">핸들러가 호출하는 함수 선언 (&quot;PythonHandler &quot; 에서 Python 빼고 &quot;handler&quot;가 호출됨)</span></div><div>    req.content_type = &quot;text/plain&quot;</div><div>    req.write(&quot;Hello World!&quot;)</div><div>    return apache.OK</div><div><br/></div><div>n. /sjopen/ 으로 요청하면 /site/omd/ 로 리다이렉트</div><div>/omd/sites/sjopen/etc/apache/conf.d/omd.conf</div><div><br/></div><div>RewriteRule ^/sjopen/?$ %{ENV:proto}://%{SERVER_NAME}/sjopen/omd/ [R=302]</div><div><br/></div><div>Alias /sjopen/omd &quot;/omd/sites/sjopen/share/omd/htdocs&quot;</div><div><br/></div><div>&lt;Directory &quot;/omd/sites/sjopen/share/omd/htdocs&quot;&gt;</div><div><br/></div><div>  &lt;IfModule mod_python.c&gt;</div><div>    AddHandler mod_python .py</div><div>    PythonHandler index</div><div>    # Make sure each site uses it's own Python interpreter (module cache!)</div><div>    PythonInterpreter sjopen</div><div>    PythonDebug On</div><div>    DirectoryIndex index.py</div><div>  &lt;/IfModule&gt;</div><div><br/></div><div>  Options FollowSymLinks</div><div>  AllowOverride None</div><div>&lt;/Directory&gt;</div><div><br/></div><div>- Public Document 에 대한 설정</div><div>Alias /sjopen &quot;/omd/sites/sjopen/var/www&quot;  ==&gt; 이 디렉토리에는 파일이 하나도 없음</div><div><br/></div><div><br/></div><div>- 결국 check_mk URL을 호출하면 apache는 아래의 index.py 파일을 실행해서 Client 요청을 처리한다.</div></span>
</div>
  </div>
</div>



<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://web2-cvwyjcqaye.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
							
							
							
</body></html>