<html>
<head>
  <title>Evernote Export</title>
  <basefont face="맑은 고딕" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308626 (ko-KR, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 맑은 고딕;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="8336"/>

<div>
<span><div><div>1. stack1.vbox - OpenStack Rocky in VirtualBox VM(RDO Packstack)</div><div><br/></div><div>OpenStack 배포 방법: RDO Packstack</div><div>아키텍처: allinone openstack controller + many computer nodes</div><div>Openstack version: Rocky</div><div><br/></div><div>&lt;테스트 아키텍처&gt;</div><div>VirtualBox 에 allinall openstack 구축 후 Compute node 추가</div><div><img src="OpenStack Rocky in VirtualBox_files/Image.png" type="image/png" data-filename="Image.png" width="437"/></div><div><br/></div><div>System: ThinkPad X1, Windows10</div><div>VirtualBox 구성: 2core, 4G MEM, 16G Disk, SWAP 전용 Disk 4G)</div><div>                      (allinone 구성시 최소 memory 8G 권장이지만 4G로도 테스트 가능)</div><div><img src="OpenStack Rocky in VirtualBox_files/Image [1].png" type="image/png" data-filename="Image.png" width="420"/></div><div><span style="font-size: 10pt; font-family: 바탕체;"><img src="OpenStack Rocky in VirtualBox_files/Image [2].png" type="image/png" data-filename="Image.png" width="415"/></span></div><div><span style="font-size: 10pt; font-family: 바탕체;">vbox_if1 브릿지   enp0s3  not used</span></div><div><span style="font-size: 10pt; font-family: 바탕체;">vbox_if2 HostOnly enp0s8  192.168.56.101 =&gt; 관리용, windows 에서 putty 연결</span></div><div><span style="font-size: 10pt; font-family: 바탕체;">vbox_if3 브릿지   enp0s9 </span> <span style="font-size: 10pt; font-family: 바탕체;">192.168.1.210 =&gt; </span><span style="font-size: 10pt; font-family: 바탕체;">br-ex OVS Bridge, 192.168.1.210 (설치 완료 후 br-ex에 IP 하나만 남김)</span></div><div><span style="font-size: 10pt; font-family: 바탕체;">vbox_if4 브릿지   enp0s10 not used</span></div><div><br/></div><div><br/></div><div><br/></div><div>&lt;참고문서&gt;</div><div><a href="https://www.rdoproject.org/install/packstack/">https://www.rdoproject.org/install/packstack/</a></div><div><br/></div><div>linuxbridge 기반으로 self service network 구성하는 메뉴얼</div><div><a href="https://docs.openstack.org/neutron/stein/install/controller-install-option2-rdo.html">https://docs.openstack.org/neutron/stein/install/controller-install-option2-rdo.html</a></div><div><br/></div><div>알리바바클라우드에서 정리한 RDO - How to Install Single Node OpenStack on CentOS 7</div><div><a href="https://www.alibabacloud.com/blog/594048?spm=a2c61.lp622.0.0.1d142637FvhoPX">https://www.alibabacloud.com/blog/594048?spm=a2c61.lp622.0.0.1d142637FvhoPX</a></div><div><br/></div><div>Flat Provider Networks 을 위한 OVS 및 br-ex 준비는 아래 문서를 참고하자.</div><div>Network 연결에 문제가 발생하면 이 문서를 확인해라.</div><div><a href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html/networking_guide/sec-connect-instance">https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html/networking_guide/sec-connect-instance</a></div><div><br/></div><div><br/></div><div>&lt;Target System&gt;</div><ul><li><div>2 node OpenStack Cloud 구축 후 instance running test</div></li><li><div>테스트 및 LAB 용도에 맞게 모든 instance가 physical network 에 직접 연결가능하도록 구성</div></li></ul><div><img src="OpenStack Rocky in VirtualBox_files/Image [3].png" type="image/png" data-filename="Image.png" width="502"/></div><div><br/></div><div><br/></div><div><span style="font-family: Consolas;">n. Linux OS 설치</span></div><div><span style="font-family: Consolas;">CentOS 7.6 basic</span></div><div><br/></div><div><span style="font-family: Consolas;">n. VirutalBox 에 설치된 CentOS Disk 및 network 정보</span></div><div><br/></div><div><span style="font-family: Consolas;">[root@stack1 ~]# lsblk</span></div><div><span style="font-family: Consolas;">NAME                                          MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span></div><div><span style="font-family: Consolas;">sda                                             8:0    0   16G  0 disk</span></div><div><span style="font-family: Consolas;">├─sda1                                          8:1    0    1G  0 part /boot</span></div><div><span style="font-family: Consolas;">└─sda2                                          8:2    0   15G  0 part</span></div><div><span style="font-family: Consolas;">  ├─centos-root                               253:0    0 13.4G  0 lvm  /</span></div><div><span style="font-family: Consolas;">  └─centos-swap                               253:1    0  1.6G  0 lvm  [SWAP]</span></div><div><span style="font-family: Consolas;">sdb                                             8:16   0    4G  0 disk [SWAP]</span></div><div><br/></div><div><span style="font-family: Consolas;">[root@</span><span style="font-family: Consolas;">stack1 </span><span style="font-family: Consolas;">~]# ip a</span></div><div><span style="font-family: Consolas;">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span></div><div><span style="font-family: Consolas;">    link/ether 08:00:27:25:f8:7c brd ff:ff:ff:ff:ff:ff</span></div><div><span style="font-family: Consolas;">    inet 192.168.1.220/24 brd 192.168.1.255 scope global enp0s3</span></div><div><span style="font-family: Consolas;">       valid_lft forever preferred_lft forever</span></div><div><span style="font-family: Consolas;">    inet6 fe80::a00:27ff:fe25:f87c/64 scope link</span></div><div><span style="font-family: Consolas;">       valid_lft forever preferred_lft forever</span></div><div><span style="font-family: Consolas;">3: enp0s8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span></div><div><span style="font-family: Consolas;">    link/ether 08:00:27:69:2c:d5 brd ff:ff:ff:ff:ff:ff</span></div><div><span style="font-family: Consolas;">    inet 192.168.56.101/24 brd 192.168.56.255 scope global dynamic enp0s8</span></div><div><span style="font-family: Consolas;">       valid_lft 913sec preferred_lft 913sec</span></div><div><span style="font-family: Consolas;">    inet6 fe80::a00:27ff:fe69:2cd5/64 scope link</span></div><div><span style="font-family: Consolas;">       valid_lft forever preferred_lft forever</span></div><div><span style="font-family: Consolas;">4: enp0s9: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span></div><div><span style="font-family: Consolas;">    link/ether 08:00:27:9e:37:56 brd ff:ff:ff:ff:ff:ff</span></div><div><span style="font-family: Consolas;">5: enp0s10: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span></div><div><span style="font-family: Consolas;">    link/ether 08:00:27:9f:6b:61 brd ff:ff:ff:ff:ff:ff</span></div><div><br/></div><div>n. OS 기본 설정</div><div><br/></div><div># vi /etc/hosts</div><div>192.168.1.220 stack1.vbox.sjjslee.x1 stack1</div><div># yum -y update</div><div># systemctl stop postfix firewalld NetworkManager</div><div># systemctl disable postfix firewalld NetworkManager</div><div># setenforce 0</div><div># getenforce</div><div># vi /etc/selinux/config</div><div><br/></div><div>n. Software 설치</div><div># yum install net-tools sysstat tcpdump wget vim</div><div># yum install https://www.rdoproject.org/repos/rdo-release.rpm</div><div># yum search centos-release-openstack</div><div><span style="font-family: 바탕체;">centos-release-openstack-ocata.noarch : OpenStack from the CentOS Cloud SIG repo configs</span></div><div><span style="font-family: 바탕체;">centos-release-openstack-pike.x86_64 : OpenStack from the CentOS Cloud SIG repo configs</span></div><div><span style="font-family: 바탕체;">centos-release-openstack-queens.noarch : OpenStack from the CentOS Cloud SIG repo configs</span></div><div><span style="color: rgb(255, 0, 0); font-family: 바탕체;">centos-release-openstack-rocky.noarch : OpenStack from the CentOS Cloud SIG repo configs</span></div><div><span style="font-family: 바탕체;">centos-release-openstack-stein.noarch : OpenStack from the CentOS Cloud SIG repo configs</span></div><div><br/></div><div># yum install -y centos-release-openstack-rocky</div><div># yum update –y</div><div># shutdown -r now</div><div><br/></div><div>n. Openstack 자동배포 software 설치</div><div># yum install  openstack-packstack</div><div><br/></div><div>n. packstack answer 파일 생성</div><div>single interface 구성을 위한 설정</div><div># packstack --allinone --provision-demo=n --os-neutron-ovs-bridge-mappings=s9-HOME:br-ex --os-neutron-ovs-bridge-interfaces=br-ex:enp0s9 --os-neutron-ml2-type-drivers=vxlan,flat --gen-answer-file=20180917_my_answers_ovs.txt</div><div><br/></div><div>n. packstack answer 파일 수정</div><div><br/></div><div># vi <span style="font-family: &quot;맑은 고딕 Semilight&quot;;">20180917_my_answers_ovs.txt</span></div><div>CONFIG_DEFAULT_PASSWORD=openstack3   # default password 설정</div><div>CONFIG_SERVICE_WORKERS=1</div><div>CONFIG_HEAT_INSTALL=n</div><div>CONFIG_NTP_SERVERS=0.ro.pool.ntp.org</div><div><span style="color: rgb(255, 0, 0);">CONFIG_KEYSTONE_ADMIN_PW=openstack3  </span><span style="color: rgb(255, 0, 0);"># admin password 설정</span></div><div>CONFIG_HORIZON_SSL=n    # enable 하면 절차가 복잡해진다.</div><div>CONFIG_HEAT_CFN_INSTALL=y</div><div>CONFIG_PROVISION_DEMO=n</div><div>CONFIG_CINDER_VOLUMES_SIZE=50G</div><div>CONFIG_NEUTRON_INSTALL=y</div><div>CONFIG_NEUTRON_L3_EXT_BRIDGE=br-ex  # dhcp, route 등에 사용할 bridge name</div><div>CONFIG_NEUTRON_METADATA_PW=1b0c414e0c484d13</div><div>CONFIG_NEUTRON_METERING_AGENT_INSTALL=y</div><div>CONFIG_NEUTRON_FWAAS=n</div><div>CONFIG_NEUTRON_VPNAAS=n</div><div><span style="color: rgb(255, 0, 0);">CONFIG_NEUTRON_ML2_TYPE_DRIVERS=vxlan,flat  </span><span style="color: rgb(255, 0, 0);"># 지원할 네트워크 타입</span></div><div>CONFIG_NEUTRON_ML2_TENANT_NETWORK_TYPES=vxlan</div><div><span style="color: rgb(255, 0, 0);">CONFIG_NEUTRON_ML2_MECHANISM_DRIVERS=openvswitch</span>  # linuxbridge 대신 openvswitch를 사용</div><div>CONFIG_NEUTRON_ML2_FLAT_NETWORKS=*</div><div>CONFIG_NEUTRON_ML2_VNI_RANGES=10:100</div><div>CONFIG_NEUTRON_L2_AGENT=openvswitch # ['linuxbridge', 'openvswitch', 'ovn']</div><div>CONFIG_NEUTRON_LB_INTERFACE_MAPPINGS=physnet1:eth1</div><div><span style="color: rgb(255, 0, 0);">CONFIG_NEUTRON_OVS_BRIDGE_MAPPINGS=s9-HOME:br-ex</span>   # s9-HOME 네트워크 연결에 br-ex bridge 사용</div><div>CONFIG_NEUTRON_OVS_BRIDGE_IFACES=br-ex:enp0s9           # br-ex bridge 물리 인터페이스에 enp0s9 사용</div><div>CONFIG_NEUTRON_OVS_EXTERNAL_PHYSNET=s9-HOME        # External 연결에 s9-HOME 네트워크 사용하겠다.</div><div>CONFIG_NEUTRON_OVS_VXLAN_UDP_PORT=4789</div><div>CONFIG_NEUTRON_OVN_BRIDGE_MAPPINGS=s9-HOMEbr-ex  # OVN 으로 변경할 경우를 대비해서 준비</div><div>CONFIG_NEUTRON_OVN_EXTERNAL_PHYSNET=s9-HOME       # OVN 으로 변경할 경우를 대비해서 준비</div><div><br/></div><div># grep -i &quot;CONFIG_NEUTRON&quot; 20180916_my_answers.txt |grep -v &quot;^#&quot;</div><div># grep -i &quot;ML2\|AGENT\|OPENV\|OVS\|LB\|L3\L2&quot; 20180916_my_answers.txt |grep -v &quot;^#&quot;</div><div><br/></div><div>n. vbox 에서 snapshot 찍고 packstack 설치 시작(실패할 경우를 대비)</div><div>   30분 이상 진행하므로 session 종료에 대비하기위해 screen session 으로 진행</div><div>   packstack 을 실행하면 puppet automation tool 을 사용해서 설치 및 구성이 진행된다.</div><div># screen</div><div><span style="font-family: &quot;맑은 고딕 Semilight&quot;;">$ </span><span style="font-family: &quot;맑은 고딕 Semilight&quot;; line-height: 1.45;">packstack --answer-file=</span><span style="font-family: &quot;맑은 고딕 Semilight&quot;;">20180917_my_answers_ovs.txt</span></div><div><img src="OpenStack Rocky in VirtualBox_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><span style="font-size: 10pt; font-family: Consolas;">**** Installation completed successfully ******</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt; font-family: Consolas;">Additional information:</span></div><div><span style="font-size: 10pt; font-family: Consolas;">* File /root/keystonerc_admin has been created on OpenStack client host 192.168.1.220. To use the command line tools you need to source the file.</span></div><div><span style="font-size: 10pt; font-family: Consolas;">* To access the OpenStack Dashboard browse to</span> <a href="http://192.168.1.220/dashboard" style="font-size: 10pt; font-family: Consolas;">http://192.168.1.220/dashboard</a> <span style="font-size: 10pt; font-family: Consolas;">.</span></div><div><span style="font-size: 10pt; font-family: Consolas;">Please, find your login credentials stored in the keystonerc_admin in your home directory.</span></div><div><span style="font-size: 10pt; font-family: Consolas;">* The installation log file is available at: /var/tmp/packstack/20190816-234624-l1HxcD/openstack-setup.log</span></div><div><span style="font-size: 10pt; font-family: Consolas;">* The generated manifests are available at: /var/tmp/packstack/20190816-234624-l1HxcD/manifests</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt; font-family: Consolas;">n. OVS bridge 가 구서되었는지 확인한다.</span></div><div><span style="font-size: 10pt; font-family: Consolas;">[root@stack1 ~]# ip a</span></div><div><span style="font-size: 10pt; font-family: Consolas;">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span></div><div><span style="font-size: 10pt; font-family: Consolas;">    link/ether 08:00:27:25:f8:7c brd ff:ff:ff:ff:ff:ff</span></div><div><span style="font-size: 10pt; font-family: Consolas;">    inet 192.168.1.220/24 brd 192.168.1.255 scope global enp0s3</span></div><div><span style="font-size: 10pt; font-family: Consolas;">       valid_lft forever preferred_lft forever</span></div><div><span style="font-size: 10pt; font-family: Consolas;">    inet6 fe80::a00:27ff:fe25:f87c/64 scope link</span></div><div><span style="font-size: 10pt; font-family: Consolas;">       valid_lft forever preferred_lft forever</span></div><div><span style="font-size: 10pt; font-family: Consolas;">3: enp0s8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span></div><div><span style="font-size: 10pt; font-family: Consolas;">    link/ether 08:00:27:69:2c:d5 brd ff:ff:ff:ff:ff:ff</span></div><div><span style="font-size: 10pt; font-family: Consolas;">    inet 192.168.56.101/24 brd 192.168.56.255 scope global dynamic enp0s8</span></div><div><span style="font-size: 10pt; font-family: Consolas;">       valid_lft 927sec preferred_lft 927sec</span></div><div><span style="font-size: 10pt; font-family: Consolas;">    inet6 fe80::a00:27ff:fe69:2cd5/64 scope link</span></div><div><span style="font-size: 10pt; font-family: Consolas;">       valid_lft forever preferred_lft forever</span></div><div><span style="font-size: 10pt; font-family: Consolas;">4:</span> <span style="font-size: 10pt; color: rgb(255, 0, 0); font-family: Consolas;">enp0s9</span><span style="font-size: 10pt; font-family: Consolas;">: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast</span> <span style="font-size: 10pt; color: rgb(255, 0, 0); font-family: Consolas;">master ovs-system state UP</span> <span style="font-size: 10pt; font-family: Consolas;">group default qlen 1000</span></div><div><span style="font-size: 10pt; font-family: Consolas;">    link/ether 08:00:27:9e:37:56 brd ff:ff:ff:ff:ff:ff</span></div><div><span style="font-size: 10pt; font-family: Consolas;">    inet6 fe80::a00:27ff:fe9e:3756/64 scope link</span></div><div><span style="font-size: 10pt; font-family: Consolas;">       valid_lft forever preferred_lft forever</span></div><div><span style="font-size: 10pt; font-family: Consolas;">5: enp0s10: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span></div><div><span style="font-size: 10pt; font-family: Consolas;">    link/ether 08:00:27:9f:6b:61 brd ff:ff:ff:ff:ff:ff</span></div><div><span style="font-size: 10pt;"><span style="font-family: Consolas; font-size: 10pt; color: rgb(255, 0, 0);">8: ovs-system: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span></span></div><div><span style="font-size: 10pt;"><span style="font-family: Consolas; font-size: 10pt; color: rgb(255, 0, 0);">    link/ether 46:35:05:6f:e1:8e brd ff:ff:ff:ff:ff:ff</span></span></div><div><span style="font-size: 10pt;"><span style="font-family: Consolas; font-size: 10pt; color: rgb(255, 0, 0);">9: br-ex: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span></span></div><div><span style="font-size: 10pt;"><span style="font-family: Consolas; font-size: 10pt; color: rgb(255, 0, 0);">    link/ether 08:00:27:9e:37:56 brd ff:ff:ff:ff:ff:ff</span></span></div><div><span style="font-size: 10pt;"><span style="font-family: Consolas; font-size: 10pt; color: rgb(255, 0, 0);">10: br-int: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span></span></div><div><span style="font-size: 10pt;"><span style="font-family: Consolas; font-size: 10pt; color: rgb(255, 0, 0);">    link/ether b6:51:b5:0a:5b:4d brd ff:ff:ff:ff:ff:ff</span></span></div><div><span style="font-size: 10pt;"><span style="font-family: Consolas; font-size: 10pt; color: rgb(255, 0, 0);">11: br-tun: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span></span></div><div><span style="font-size: 10pt;"><span style="font-family: Consolas; font-size: 10pt; color: rgb(255, 0, 0);">    link/ether 06:78:b6:44:9a:43 brd ff:ff:ff:ff:ff:ff</span></span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt; font-family: Consolas;">n. packstack 완료 후 </span><span style="font-size: 10pt; font-family: Consolas;">enp0s9 가 up 되었고 </span><span style="font-size: 13.3333px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Consolas; font-variant-caps: normal; font-variant-ligatures: normal;">network script 파일도</span> <span style="font-size: 10pt; font-family: Consolas;">DEVICETYPE=ovs 로 </span><span style="font-size: 13.3333px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Consolas; font-variant-caps: normal; font-variant-ligatures: normal;">수정되었다.</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt; font-family: Consolas;"># cat /etc/sysconfig/network-scripts/ifcfg-enp0s9</span></div><div><span style="font-size: 10pt; font-family: Consolas;">DEVICE=enp0s9</span></div><div><span style="font-size: 10pt; font-family: Consolas;">NAME=enp0s9</span></div><div><span style="font-size: 10pt; font-family: Consolas;">DEVICETYPE=ovs</span></div><div><span style="font-size: 10pt; font-family: Consolas;">TYPE=OVSPort</span></div><div><span style="font-size: 10pt; font-family: Consolas;">OVS_BRIDGE=br-ex</span></div><div><span style="font-size: 10pt; font-family: Consolas;">ONBOOT=yes</span></div><div><span style="font-size: 10pt; font-family: Consolas;">BOOTPROTO=none</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt; font-family: Consolas;"># cat /etc/sysconfig/network-scripts/</span><span style="font-size: 10pt;">ifcfg-br-ex</span></div><div><span style="font-size: 10pt;">ONBOOT=yes</span></div><div><span style="font-size: 10pt;">PEERDNS=no</span></div><div><span style="font-size: 10pt;">NM_CONTROLLED=no</span></div><div><span style="font-size: 10pt;">NOZEROCONF=yes</span></div><div><span style="font-size: 10pt;">DEVICE=br-ex</span></div><div><span style="font-size: 10pt;">NAME=br-ex</span></div><div><span style="font-size: 10pt;">DEVICETYPE=ovs</span></div><div><span style="font-size: 10pt;">OVSBOOTPROTO=static</span></div><div><span style="font-size: 10pt;">TYPE=OVSBridge</span></div><div><span style="font-size: 10pt;">OVS_EXTRA=&quot;set bridge br-ex fail_mode=standalone&quot;</span></div><div><span style="font-size: 10pt;">BOOTPROTO=static</span></div><div><span style="font-size: 10pt;">IPADDR=192.168.1.220</span></div><div><span style="font-size: 10pt;">NETMASK=255.255.255.0</span></div><div><span style="font-size: 10pt;">GATEWAY=192.168.1.1</span></div><div><span style="font-size: 10pt;">DNS1=8.8.8.8</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;">n. br-ex bridge 에 physical interface가 연결되었는지 확인</span></div><div><span style="font-size: 10pt; font-family: Consolas;"><br/></span></div><div><span style="font-size: 10pt; font-family: Consolas;">[root@stack1 ~]# ovs-vsctl show</span></div><div><span style="font-size: 10pt; font-family: Consolas;">69c97bdc-ded2-4318-94b9-fbbfde4421cc</span></div><div><span style="font-size: 10pt; font-family: Consolas;">    Manager &quot;ptcp:6640:127.0.0.1&quot;</span></div><div><span style="font-size: 10pt; font-family: Consolas;">        is_connected: true</span></div><div><span style="font-size: 10pt; font-family: Consolas;">    Bridge br-int</span></div><div><span style="font-size: 10pt; font-family: Consolas;">        Controller &quot;tcp:127.0.0.1:6633&quot;</span></div><div><span style="font-size: 10pt; font-family: Consolas;">            is_connected: true</span></div><div><span style="font-size: 10pt; font-family: Consolas;">        fail_mode: secure</span></div><div><span style="font-size: 10pt; font-family: Consolas;">        Port patch-tun</span></div><div><span style="font-size: 10pt; font-family: Consolas;">            Interface patch-tun</span></div><div><span style="font-size: 10pt; font-family: Consolas;">                type: patch</span></div><div><span style="font-size: 10pt; font-family: Consolas;">                options: {peer=patch-int}</span></div><div><span style="font-size: 10pt; font-family: Consolas;">        Port br-int</span></div><div><span style="font-size: 10pt; font-family: Consolas;">            Interface br-int</span></div><div><span style="font-size: 10pt; font-family: Consolas;">                type: internal</span></div><div><span style="font-size: 10pt; font-family: Consolas;">        Port int-br-ex</span></div><div><span style="font-size: 10pt; font-family: Consolas;">            Interface int-br-ex</span></div><div><span style="font-size: 10pt; font-family: Consolas;">                type: patch</span></div><div><span style="font-size: 10pt; font-family: Consolas;">                options: {peer=phy-br-ex}</span></div><div><span style="font-size: 10pt; font-family: Consolas;">    Bridge br-tun</span></div><div><span style="font-size: 10pt; font-family: Consolas;">        Controller &quot;tcp:127.0.0.1:6633&quot;</span></div><div><span style="font-size: 10pt; font-family: Consolas;">            is_connected: true</span></div><div><span style="font-size: 10pt; font-family: Consolas;">        fail_mode: secure</span></div><div><span style="font-size: 10pt; font-family: Consolas;">        Port br-tun</span></div><div><span style="font-size: 10pt; font-family: Consolas;">            Interface br-tun</span></div><div><span style="font-size: 10pt; font-family: Consolas;">                type: internal</span></div><div><span style="font-size: 10pt; font-family: Consolas;">        Port patch-int</span></div><div><span style="font-size: 10pt; font-family: Consolas;">            Interface patch-int</span></div><div><span style="font-size: 10pt; font-family: Consolas;">                type: patch</span></div><div><span style="font-size: 10pt; font-family: Consolas;">                options: {peer=patch-tun}</span></div><div><span style="font-size: 10pt; font-family: Consolas;"> <span style="font-family: Consolas; font-size: 10pt; color: rgb(255, 0, 0);">   Bridge br-ex</span></span></div><div><span style="font-size: 10pt; font-family: Consolas;">        Controller &quot;tcp:127.0.0.1:6633&quot;</span></div><div><span style="font-size: 10pt; font-family: Consolas;">            is_connected: true</span></div><div><span style="font-size: 10pt; font-family: Consolas;">        fail_mode: secure</span></div><div><span style="font-size: 10pt; font-family: Consolas;">        Port phy-br-ex</span></div><div><span style="font-size: 10pt; font-family: Consolas;">            Interface phy-br-ex</span></div><div><span style="font-size: 10pt; font-family: Consolas;">                type: patch</span></div><div><span style="font-size: 10pt; font-family: Consolas;">                options: {peer=int-br-ex}</span></div><div><span style="font-size: 10pt; font-family: Consolas;">        Port br-ex</span></div><div><span style="font-size: 10pt; font-family: Consolas;">            Interface br-ex</span></div><div><span style="font-size: 10pt; font-family: Consolas;">                type: internal</span></div><div><span style="font-size: 10pt; font-family: Consolas;">        <span style="font-size: 10pt; font-family: Consolas; color: rgb(255, 0, 0);">Port &quot;enp0s9&quot;</span></span></div><div><span style="font-size: 10pt; font-family: Consolas;">           <span style="font-size: 10pt; font-family: Consolas; color: rgb(255, 0, 0);"> Interface &quot;enp0s9&quot;  =&gt; OK</span></span></div><div><span style="font-size: 10pt; font-family: Consolas;">    ovs_version: &quot;2.11.0&quot;</span></div><div><span style="font-size: 10pt; font-family: Consolas;">[root@stack1 ~]#</span></div><div><span style="font-size: 10pt; font-family: Consolas;">[root@stack1 ~]#</span><span style="font-size: 10pt; font-family: Consolas;"> brctl show</span></div><div><span style="font-size: 10pt; font-family: Consolas;">bridge name     bridge id               STP enabled     interfaces</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;">Linux birgde 는 하나도 사용되지 않았다.</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt; font-family: Consolas;">n. packstack이 자동으로 배포한 neutron configuration 파일 확인</span></div><div><span style="font-size: 10pt; font-family: Consolas;">cat /etc/neutron/neutron.conf |</span><span style="font-size: 10pt; font-family: Consolas;">grep -v &quot;^#&quot; | </span><span style="font-size: 10pt; font-family: Consolas;">grep -v &quot;^[[:space:]]*$&quot;</span></div><div><span style="font-size: 10pt; font-family: Consolas;">cat </span><span style="font-size: 10pt; font-family: Consolas;">/etc/neutron/plugins/ml2/ml2_conf.ini </span><span style="font-size: 10pt; font-family: Consolas;">|</span><span style="font-size: 10pt; font-family: Consolas;">grep -v &quot;^#&quot; | </span><span style="font-size: 10pt; font-family: Consolas;">grep -v &quot;^[[:space:]]*$&quot;</span></div><div><span style="font-size: 10pt; font-family: Consolas;">cat </span><span style="font-size: 10pt; font-family: Consolas;">/etc/neutron/plugins/ml2/linuxbridge_agent.ini =&gt; not found</span></div><div><span style="font-size: 10pt; font-family: Consolas;">cat </span><span style="font-size: 10pt; font-family: Consolas;">/etc/neutron/plugins/ml2/openvswitch_agent.ini </span><span style="font-size: 10pt; font-family: Consolas;">|</span><span style="font-size: 10pt; font-family: Consolas;">grep -v &quot;^#&quot; | </span><span style="font-size: 10pt; font-family: Consolas;">grep -v &quot;^[[:space:]]*$&quot;</span></div><div><span style="font-size: 10pt; font-family: Consolas;">cat </span><span style="font-size: 10pt; font-family: Consolas;">/etc/neutron/l3_agent.ini </span><span style="font-size: 10pt; font-family: Consolas;">|</span><span style="font-size: 10pt; font-family: Consolas;">grep -v &quot;^#&quot; | </span><span style="font-size: 10pt; font-family: Consolas;">grep -v &quot;^[[:space:]]*$&quot;</span></div><div><span style="font-size: 10pt; font-family: Consolas;">cat </span><span style="font-size: 10pt; font-family: Consolas;">/etc/neutron/dhcp_agent.ini </span><span style="font-size: 10pt; font-family: Consolas;">|</span><span style="font-size: 10pt; font-family: Consolas;">grep -v &quot;^#&quot; | </span><span style="font-size: 10pt; font-family: Consolas;">grep -v &quot;^[[:space:]]*$&quot;</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;">n. neutron service 상태 확인</span></div><div><span style="font-size: 10pt; font-family: Consolas;"># systemctl list-unit-files |grep neutron</span></div><div><span style="font-size: 10pt; font-family: Consolas;">neutron-destroy-patch-ports.service           enabled</span></div><div><span style="font-size: 10pt; font-family: Consolas;">neutron-dhcp-agent.service                    enabled</span></div><div><span style="font-size: 10pt; font-family: Consolas;">neutron-l3-agent.service                      enabled</span></div><div><span style="font-size: 10pt; font-family: Consolas;">neutron-linuxbridge-cleanup.service           disabled</span></div><div><span style="font-size: 10pt; font-family: Consolas;">neutron-metadata-agent.service                enabled</span></div><div><span style="font-size: 10pt; font-family: Consolas;">neutron-metering-agent.service                enabled</span></div><div><span style="font-size: 10pt; font-family: Consolas;">neutron-netns-cleanup.service                 disabled</span></div><div><span style="font-size: 10pt; font-family: Consolas;">neutron-openvswitch-agent.service             enabled</span></div><div><span style="font-size: 10pt; font-family: Consolas;">neutron-ovs-cleanup.service                   enabled</span></div><div><span style="font-size: 10pt; font-family: Consolas;">neutron-server.service                        enabled</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;">n. 자동으로 배포된 flavor list 확인</span></div><div><span style="font-size: 10pt;">openstack 패키지는 default flavor 를 제공하지 않지만 packsatck 이 등록한 것이다. </span></div><div><span style="font-size: 10pt;">하지만 테스트 환경에는 너무 크니 테스트 환경에 맞도로 아주 작은 flavor 를 등록해준다.</span></div><div><span style="font-size: 10pt;">64M 짜리 VM 을 위한 flaver는 꼭 등록하자.</span></div><div><span style="font-size: 10pt; font-family: Consolas;">[root@stack1 ~]#</span></div><div><span style="font-size: 10pt; font-family: Consolas;"># openstack flavor list</span></div><div><span style="font-size: 10pt; font-family: Consolas;">+----+-----------+-------+------+-----------+-------+-----------+</span></div><div><span style="font-size: 10pt; font-family: Consolas;">| ID | Name      |   RAM | Disk | Ephemeral | VCPUs | Is Public |</span></div><div><span style="font-size: 10pt; font-family: Consolas;">+----+-----------+-------+------+-----------+-------+-----------+</span></div><div><span style="font-size: 10pt; font-family: Consolas;">| 1  | m1.tiny   |   512 |    1 |         0 |     1 | True      |</span></div><div><span style="font-size: 10pt; font-family: Consolas;">| 2  | m1.small  |  2048 |   20 |         0 |     1 | True      |</span></div><div><span style="font-size: 10pt; font-family: Consolas;">| 3  | m1.medium |  4096 |   40 |         0 |     2 | True      |</span></div><div><span style="font-size: 10pt; font-family: Consolas;">| 4  | m1.large  |  8192 |   80 |         0 |     4 | True      |</span></div><div><span style="font-size: 10pt; font-family: Consolas;">| 5  | m1.xlarge | 16384 |  160 |         0 |     8 | True      |</span></div><div><span style="font-size: 10pt; font-family: Consolas;">+----+-----------+-------+------+-----------+-------+-----------+</span></div><div><br/></div><div><span style="font-size: 10pt; font-family: Consolas;">openstack flavor create --id 6 --vcpus 1 --ram 64    --disk  1  m1.nano</span></div><div><span style="font-size: 10pt; font-family: Consolas;">openstack flavor create --id 7 --vcpus 2 --ram 512   --disk 10  m1.tiny</span></div><div><span style="font-size: 10pt; font-family: Consolas;">openstack flavor create --id 8 --vcpus 2 --ram 1024  --disk 20  m1.small</span></div><div><span style="font-size: 10pt; font-family: Consolas;">openstack flavor create --id 9 --vcpus 4 --ram 2048  --disk 40  m1.medium</span></div><div><span style="font-size: 10pt; font-family: Consolas;">openstack flavor create --id 10 --vcpus 2 --ram 512   --disk 10 --ephemeral 10 --swap</span> <span style="font-size: 10pt; font-family: Consolas;">2048 m1.tiny2</span></div><div><span style="font-size: 10pt; font-family: Consolas;">openstack flavor list</span></div><div><font face="Consolas" style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-family: Consolas;">n. VM 테스트용 최소용량 cloud image 등록(64 Memory 에서 OK)</span></div><div><span style="font-size: 10pt; font-family: Consolas;">wget</span> <a href="http://download.cirros-cloud.net/0.4.0/cirros-0.4.0-x86_64-disk.img" style="font-size: 10pt; color: rgb(255, 0, 0); font-family: Consolas;">http://download.cirros-cloud.net/0.4.0/cirros-0.4.0-x86_64-disk.img</a></div><div><span style="font-size: 10pt; font-family: Consolas;">openstack image create &quot;cirros&quot; --file cirros-0.4.0-x86_64-disk.img --disk-format qcow2 --container-format bare --public</span></div><div><font face="Consolas" style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-family: Consolas;">n. </span><span style="font-size: 10pt; font-family: Consolas;">security group 에서 ssh 및 ping 허용</span></div><div><span style="font-size: 10pt; font-family: Consolas;">ping 및 ssh 마저도 막혀 있으니 필요한 port 는 사전에 등록해준다.</span></div><div><span style="font-size: 10pt; font-family: Consolas;">openstack security group list</span></div><div><span style="font-size: 10pt; font-family: Consolas;">openstack security group rule list default</span></div><div><span style="font-size: 10pt; font-family: Consolas;">openstack security group rule create --proto icmp default</span></div><div><span style="font-size: 10pt; font-family: Consolas;">openstack security group rule create --proto tcp --dst-port 22 default</span></div><div><span style="font-size: 10pt; font-family: Consolas;">openstack security group rule create --proto tcp --dst-port 80 default</span></div><div><span style="font-size: 10pt; font-family: Consolas;">openstack security group rule create --proto tcp --dst-port 443 default</span></div><div><font face="Consolas" style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-family: Consolas;">n. ssh key login 을 위해 Keypair 등록</span></div><div><span style="font-size: 10pt; font-family: Consolas;">cloud 에서 사용하는 cloud image 들은 passwd login을 지운하지 않으므로 public key를 등록해준다.</span></div><div><span style="font-size: 10pt; font-family: Consolas;"># ssh-keygen -q -N &quot;&quot; =&gt; 이미 있으므로 생략</span></div><div><span style="font-size: 10pt; font-family: Consolas;">openstack keypair create --public-key ~/.ssh/id_rsa.pub </span><span style="font-size: 10pt; font-family: Consolas;">stack1</span><span style="font-size: 10pt; font-family: Consolas;">_vbox_X1_key</span></div><div><span style="font-size: 10pt; font-family: Consolas;">openstack keypair list</span></div><div><font face="Consolas" style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-family: Consolas;">n. flat provider network 생성</span></div><div><span style="font-size: 10pt; font-family: Consolas;">Physical network 대역에 직접 연결되는 network, 이 네트워크에 연결하면 외부 IP가 VM 에 자동 할당된다.</span></div><div><span style="font-size: 10pt; font-family: Consolas;">공유기 IP 대역인 </span><span style="font-size: 10pt; font-family: Consolas;">92.168.1.X 대역을 등록한다.</span></div><div><span style="font-size: 10pt; font-family: Consolas;"># openstack network create  --share --external --provider-physical-network s9-HOME --provider-network-type flat extnet</span></div><div><span style="font-size: 10pt; font-family: Consolas;"># openstack subnet create --network extnet \</span></div><div><span style="font-size: 10pt; font-family: Consolas;">  --allocation-pool start=192.168.1.231,end=192.168.1.240 \</span></div><div><span style="font-size: 10pt; font-family: Consolas;">  --dns-nameserver 168.126.63.1 --gateway 192.168.1.1 \</span></div><div><span style="font-size: 10pt; font-family: Consolas;">  --subnet-range 192.168.1.0/24 SUBNET-MYHOME</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt; font-family: Consolas;">n. port list 명령으로 dhcp port 가 active 상태인지 확인한다.</span></div><div><span style="font-size: 10pt; font-family: Consolas;"># openstack network list</span></div><div><span style="font-size: 10pt; font-family: Consolas;"># openstack subnet list</span></div><div><span style="font-size: 10pt; font-family: Consolas;"># openstack port list</span></div><div><span style="font-size: 10pt; font-family: Consolas;"># </span><span style="font-size: 10pt; font-family: Consolas;">openstack port show e4b2fca7-8667-482d-8c00-98f3ec4d4f2f  =&gt; </span><span style="font-size: 10pt; font-family: Consolas;">ACTIVE</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt; font-family: Consolas;">n. private network 등록</span></div><div><span style="font-size: 10pt; font-family: Consolas;">openstack network create NET-Private1</span></div><div><span style="font-size: 10pt; font-family: Consolas;">openstack subnet create --network NET-Private1 \</span></div><div><span style="font-size: 10pt; font-family: Consolas;">  --dns-nameserver </span> <span style="font-size: 10pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Consolas; font-variant-caps: normal; font-variant-ligatures: normal;">10.10.10.1</span> <span style="font-size: 10pt; font-family: Consolas;">--gateway 10.10.10.1 \</span></div><div><span style="font-size: 10pt; font-family: Consolas;">  --subnet-range</span> <span style="font-size: 10pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Consolas; font-variant-caps: normal; font-variant-ligatures: normal;">10.10.10</span><span style="font-size: 10pt; font-family: Consolas;">.0/24 SUBNET-10</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt; font-family: Consolas;">n. 첫번재 VM 실행 테스트</span></div><div><span style="font-size: 10pt; font-family: Consolas;">[root@stack1 ~(keystone_admin)]#</span><span style="font-size: 10pt; font-family: Consolas;"> openstack server create --flavor </span><span style="font-size: 10pt; font-family: Consolas;">m1.nano</span> <span style="font-size: 10pt; font-family: Consolas;">--image cirros \</span></div><div><span style="font-size: 10pt; font-family: Consolas;">  --nic net-id=extnet --security-group</span> <span style="font-size: 10pt; font-family: Consolas;">6478fc8f-6b09-40ba-8614-7b7474aec185 </span><span style="font-size: 10pt; font-family: Consolas;">\</span></div><div><span style="font-size: 10pt; font-family: Consolas;">  --key-name</span> <span style="font-size: 10pt; font-family: Consolas;">stack1</span><span style="font-size: 10pt; font-family: Consolas;">_vbox_X1_key testvm</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt; font-family: Consolas;">n. bridge 및 ovs interface 가 생성되었음</span></div><div><span style="font-size: 10pt; font-family: Consolas;">[root@stack1 ~(keystone_admin)]# brctl show</span></div><div><span style="font-size: 10pt; font-family: Consolas;">bridge name     bridge id               STP enabled     interfaces</span></div><div><span style="font-size: 10pt; font-family: Consolas;">qbrab518d86-9d          8000.fafcceca2237       no      qvbab518d86-9d</span></div><div><span style="font-size: 10pt; font-family: Consolas;">                                                        tapab518d86-9d</span></div><div><span style="font-size: 10pt; font-family: Consolas;">4: enp0s9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast master ovs-system state UP group default qlen 1000</span></div><div><span style="font-size: 10pt; font-family: Consolas;">    link/ether 08:00:27:9e:37:56 brd ff:ff:ff:ff:ff:ff</span></div><div><span style="font-size: 10pt; font-family: Consolas;">    inet6 fe80::a00:27ff:fe9e:3756/64 scope link</span></div><div><span style="font-size: 10pt; font-family: Consolas;">       valid_lft forever preferred_lft forever</span></div><div><span style="font-size: 10pt; font-family: Consolas;">5: enp0s10: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span></div><div><span style="font-size: 10pt; font-family: Consolas;">    link/ether 08:00:27:9f:6b:61 brd ff:ff:ff:ff:ff:ff</span></div><div><span style="font-size: 10pt; font-family: Consolas;">8: ovs-system: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span></div><div><span style="font-size: 10pt; font-family: Consolas;">    link/ether 46:35:05:6f:e1:8e brd ff:ff:ff:ff:ff:ff</span></div><div><span style="font-size: 10pt; font-family: Consolas;">9: br-ex: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span></div><div><span style="font-size: 10pt; font-family: Consolas;">    link/ether 08:00:27:9e:37:56 brd ff:ff:ff:ff:ff:ff</span></div><div><span style="font-size: 10pt; font-family: Consolas;">10: br-int: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span></div><div><span style="font-size: 10pt; font-family: Consolas;">    link/ether b6:51:b5:0a:5b:4d brd ff:ff:ff:ff:ff:ff</span></div><div><span style="font-size: 10pt; font-family: Consolas;">11: br-tun: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span></div><div><span style="font-size: 10pt; font-family: Consolas;">    link/ether 06:78:b6:44:9a:43 brd ff:ff:ff:ff:ff:ff</span></div><div><span style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(255, 0, 0); font-family: Consolas;">13: qbrab518d86-9d: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span></span></div><div><span style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(255, 0, 0); font-family: Consolas;">    link/ether fa:fc:ce:ca:22:37 brd ff:ff:ff:ff:ff:ff</span></span></div><div><span style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(255, 0, 0); font-family: Consolas;">14: qvoab518d86-9d@qvbab518d86-9d: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master ovs-system state UP group default qlen 1000</span></span></div><div><span style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(255, 0, 0); font-family: Consolas;">    link/ether d2:a8:c1:54:43:de brd ff:ff:ff:ff:ff:ff</span></span></div><div><span style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(255, 0, 0); font-family: Consolas;">    inet6 fe80::d0a8:c1ff:fe54:43de/64 scope link</span></span></div><div><span style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(255, 0, 0); font-family: Consolas;">       valid_lft forever preferred_lft forever</span></span></div><div><span style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(255, 0, 0); font-family: Consolas;">15: qvbab518d86-9d@qvoab518d86-9d: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master qbrab518d86-9d state UP group default qlen 1000</span></span></div><div><span style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(255, 0, 0); font-family: Consolas;">    link/ether fa:fc:ce:ca:22:37 brd ff:ff:ff:ff:ff:ff</span></span></div><div><span style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(255, 0, 0); font-family: Consolas;">    inet6 fe80::f8fc:ceff:feca:2237/64 scope link</span></span></div><div><span style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(255, 0, 0); font-family: Consolas;">       valid_lft forever preferred_lft forever</span></span></div><div><span style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(255, 0, 0); font-family: Consolas;">16: tapab518d86-9d: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast master qbrab518d86-9d state UNKNOWN group default qlen 1000</span></span></div><div><span style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(255, 0, 0); font-family: Consolas;">    link/ether fe:16:3e:12:02:94 brd ff:ff:ff:ff:ff:ff</span></span></div><div><span style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(255, 0, 0); font-family: Consolas;">    inet6 fe80::fc16:3eff:fe12:294/64 scope link</span></span></div><div><span style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(255, 0, 0); font-family: Consolas;">       valid_lft forever preferred_lft forever</span></span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt; font-family: Consolas;">n. VM 연결 테스트.</span></div><div><span style="font-size: 10pt; font-family: Consolas;">VM booting 하면서 IP 와 ssh key 정상적으로 복사 했음.</span></div><div><span style="font-size: 10pt; font-family: Consolas;"># openstack server list</span></div><div><span style="font-size: 10pt; font-family: Consolas;">+--------------------------------------+--------+--------+----------------------+--------+---------+</span></div><div><span style="font-size: 10pt; font-family: Consolas;">| ID                                   | Name   | Status | Networks             | Image  | Flavor  |</span></div><div><span style="font-size: 10pt; font-family: Consolas;">+--------------------------------------+--------+--------+----------------------+--------+---------+</span></div><div><span style="font-size: 10pt; font-family: Consolas;">| d957f135-e4e0-4f00-a545-2ad59eea4e63 | testvm | ACTIVE | extnet=192.168.1.232 | cirros | m1.nano |</span></div><div><span style="font-size: 10pt; font-family: Consolas;">+--------------------------------------+--------+--------+----------------------+--------+---------+</span></div><div><span style="font-size: 10pt; font-family: Consolas;"># ping 192.168.1.232</span></div><div><span style="font-size: 10pt; font-family: Consolas;">PING 192.168.1.232 (192.168.1.232) 56(84) bytes of data.</span></div><div><span style="font-size: 10pt; font-family: Consolas;">64 bytes from 192.168.1.232: icmp_seq=1 ttl=64 time=26.9 ms</span></div><div><span style="font-size: 10pt; font-family: Consolas;">64 bytes from 192.168.1.232: icmp_seq=2 ttl=64 time=1.12 ms</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt; font-family: Consolas;">Vbox 에 IP 2개 설정하면 외부에서 접속이 안됨, controller 에서는 잘 됨 -&gt; 무선 연결이라 그런가?</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt; font-family: Consolas;">n. br-ex 에 single ip 설정</span></div><div><span style="font-size: 10pt; font-family: Consolas;">vbox_if1 브릿지     enp0s3</span></div><div><span style="font-size: 10pt; font-family: Consolas;">vbox_if2 Host_only enp0s8  92.168.56.101 &lt;= Host Only, WIndwos10 에서 putty 연결용</span></div><div><span style="font-size: 10pt; font-family: Consolas;">vbox_if3 브릿지     enp0s9  &lt;-&gt; br-ex:1</span><span style="font-size: 10pt; font-family: Consolas;">92.168.1.230  &lt;= External Brigde, 외부와 VM 연결</span></div><div><span style="font-size: 10pt; font-family: Consolas;">vbox_if4 브릿지     enp0s10</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt; font-family: Consolas;">ifcfg-network script 에서 첫번째 interface</span> <span style="font-size: 10pt; font-family: Consolas;">enp0s3</span><span style="font-size: 10pt; font-family: Consolas;">에 있던 host ip 를 br-ex로 변경</span></div><div><span style="font-size: 10pt; font-family: Consolas;">vbox 내부에서 8.8.8.8 로 ping ok</span></div><div><span style="font-size: 10pt; font-family: Consolas;">stack1 서버 rebooting 후 instart 재시작</span></div><div><span style="font-size: 10pt; font-family: Consolas;">stack1 서버 및 Windows PC 에서 VM 으로 ping OK</span></div><div><span style="font-size: 10pt; font-family: Consolas;">[root@stack1 ~]# ping 192.168.1.232</span></div><div><span style="font-size: 10pt; font-family: Consolas;">PING 192.168.1.232 (192.168.1.232) 56(84) bytes of data.</span></div><div><span style="font-size: 10pt; font-family: Consolas;">64 bytes from 192.168.1.232: icmp_seq=1 ttl=64 time=8.03 ms</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt; font-family: Consolas;">C:\Users\JAESIKLee&gt;ping 192.168.1.232</span></div><div><span style="font-size: 10pt; font-family: Consolas;">Ping 192.168.1.232 32바이트 데이터 사용:</span></div><div><span style="font-size: 10pt; font-family: Consolas;">192.168.1.232의 응답: 바이트=32 시간=13ms TTL=64</span></div><div><span style="font-size: 10pt; font-family: Consolas;">192.168.1.232의 응답: 바이트=32 시간=12ms TTL=64</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt; font-family: Consolas;">모든것이 잘됨. sosreport 한번 받자...</span></div><div><font face="Consolas" style="font-size: 10pt;"><br/></font></div><div><font face="Consolas" style="font-size: 10pt;">&lt;참고&gt;</font></div><div><span style="font-size: 10pt; font-family: Consolas; font-weight: bold;">n. OVS Bridge interface 설정 Sample(compute3)</span></div><div><span style="font-size: 10pt; font-family: Consolas;"> - Packstack 은 OVS를 기본으로 설정하므로 OVS Bridge를 사전에 준비해야한다.</span></div><div><span style="font-size: 10pt; font-family: Consolas;"> - 기존에 구성된 br-ex 가 있다면 기존 br-ex를 사용해서 neutron 구성도 가능</span></div><div><span style="font-size: 10pt; font-family: Consolas;"># vi /etc/sysconfig/network-scripts/ifcfg-br-ex</span></div><div><span style="font-size: 10pt; font-family: Consolas;">DEVICE=br-ex</span></div><div><span style="font-size: 10pt; font-family: Consolas;">DEVICETYPE=ovs</span></div><div><span style="font-size: 10pt; font-family: Consolas;">TYPE=OVSBridge</span></div><div><span style="font-size: 10pt; font-family: Consolas;">BOOTPROTO=static</span></div><div><span style="font-size: 10pt; font-family: Consolas;">IPADDR=172.16.40.125</span></div><div><span style="font-size: 10pt; font-family: Consolas;">NETMASK=255.255.255.0</span></div><div><span style="font-size: 10pt; font-family: Consolas;">GATEWAY=172.16.40.1</span></div><div><span style="font-size: 10pt; font-family: Consolas;">DNS1=168.126.63.1</span></div><div><span style="font-size: 10pt; font-family: Consolas;">ONBOOT=yes</span></div><div><font face="Consolas" style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-family: Consolas;"># vi /etc/sysconfig/network-scripts/ifcfg-eno4</span></div><div><span style="font-size: 10pt; font-family: Consolas;">DEVICE=eno4</span></div><div><span style="font-size: 10pt; font-family: Consolas;">ONBOOT=yes</span></div><div><span style="font-size: 10pt; font-family: Consolas;">NM_CONTROLLED=no</span></div><div><span style="font-size: 10pt; font-family: Consolas;">DEVICETYPE=ovs</span></div><div><span style="font-size: 10pt; font-family: Consolas;">TYPE=OVSPort</span></div><div><span style="font-size: 10pt; font-family: Consolas;">OVS_BRIDGE=br-ex</span></div><div><font face="Consolas" style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-family: Consolas;"># vi /etc/neutron/plugins/ml2/openvswitch_agent.ini</span></div><div><span style="font-size: 10pt; font-family: Consolas;">bridge_mappings=LAN-ROOM:br-ex</span></div><div><font face="Consolas" style="font-size: 10pt;"><br/></font></div><div><font face="Consolas" style="font-size: 10pt;">&lt;OVS 환경에서 packet 흐름 참고 문서&gt;</font></div><div><a href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html/networking_guide/sec-connect-instance" style="font-size: 10pt; font-family: Consolas;">https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html/networking_guide/sec-connect-instance</a></div><div><span style="font-size: 10pt; font-family: Consolas;"><img src="OpenStack Rocky in VirtualBox_files/Image.jpg" type="image/jpeg" data-filename="Image.jpg" width="449"/></span></div><div><font face="Consolas" style="font-size: 10pt;"><br/></font></div><div style="min-height: 9pt; text-align: left;"><span style="min-height: 9pt; font-size: 9pt; color: rgb(1, 1, 1); font-family: &quot;Courier New&quot;;">&lt;Overview&gt;</span></div><div style="min-height: 9pt; text-align: left;"><img src="OpenStack Rocky in VirtualBox_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div style="min-height: 9pt; text-align: left;"><br/></div><div style="min-height: 9pt; text-align: left;"><span style="min-height: 9pt; font-size: 9pt; color: rgb(1, 1, 1); font-family: &quot;Courier New&quot;;">&lt;Network Topology&gt;</span></div><div style="min-height: 9pt; text-align: left;"><span style="min-height: 9pt; font-size: 9pt;"><br/></span></div><div style="min-height: 9pt; text-align: left;"><span style="min-height: 9pt; font-size: 9pt;"><br/></span></div><div style="min-height: 9pt; text-align: left;"><span style="min-height: 9pt; font-size: 9pt; color: rgb(1, 1, 1); font-family: &quot;Courier New&quot;;">&lt;Flating IP 할당 후 private 망에 생성한 인스턴스로 login 테스트 OK&gt;</span></div><div style="min-height: 9pt; text-align: left;"><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: &quot;Courier New&quot;;"><img src="OpenStack Rocky in VirtualBox_files/Image [6].png" type="image/png" data-filename="Image.png" width="551"/></span></div></div><div><br/></div></span>
</div></body></html> 