<html>
<head>
  <title>Evernote Export</title>
  <basefont face="맑은 고딕 Semilight" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308489 (ko-KR, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 맑은 고딕 Semilight;
      font-size: 10pt;
    }
  </style>
  
    <link rel="stylesheet" href="style.css">
  
   <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-138982878-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-138982878-1');
</script>


</head>
<body>

  <h1><a href="index.html">URL&quot; 이 page handlers에 맵핑되는 과정 분석</a></h1>
  <div id="grid">
    <ol>
      <li><a href="1.html" class="saw">HTML</a></li>
      <li><a href="2.html" class="saw" id="active">CSS</a></li>
      <li><a href="3.html" >JavasCript</a></li>
      <li><a href="Electromagnetic_wave.html">전자기파</a></li>
      <li><a href="Check_MK_python_alz.html">mod_python</a></li>
	  <li><a href="Check_MK's_plugin_init_process.html">plugin_init</a></li>
      <li><a href="URL_to_page_handlers_mapping.html">page_handlers</a></li>
    </ol>
    <div id="article">
	
	
<a name="16964"/>

<div>
<span><div>URL&quot; 이 page handlers에 맵핑되는 과정 분석</div><div><br/></div><div>&quot;side.py URL&quot;이 &quot;page plugin&quot;에 의해서 page handlers 로 연결되는 과정 분석</div><div><br/></div><div>- URL: <a href="http://172.16.30.93/sjopen/check_mk/side.py">http://172.16.30.93/sjopen/check_mk/side.py</a></div><div>- .py 이 포함된 요청은 mod_python 설정에서 index.py 모듈의 handler() 함수를 호출</div><div>- shipped.py Plugin 모듈에서 /side.py URL의 헨들러는 sidebar.py 임을 찼는다.(routing)</div><div>- 헨들러인 sidebar.py 모듈에 HTML page를 렌더링하는 코드가 들어있다.(Tag를 출력하고 Div 로 구획을 나누고, html.write로 문자를 출력한다)</div><div><br/></div><div><br/></div><div><span style="font-family: &quot;맑은 고딕&quot;;">def handler(mod_python_req, fields = None, is_profiling = False):</span></div><div><span style="font-family: &quot;맑은 고딕&quot;;">      -&gt;</span> <span style="font-family: &quot;맑은 고딕&quot;;">modules.load_all_plugins()</span></div><div><span style="font-family: &quot;맑은 고딕&quot;;">          -&gt; def load_all_plugins()</span></div><div><span style="font-family: &quot;맑은 고딕&quot;;">              -&gt; pagehandlers.update(pagetypes.page_handlers())</span></div><div><span style="font-family: &quot;맑은 고딕&quot;;">                  -&gt; </span> <span style="font-family: &quot;맑은 고딕&quot;;">page_handlers.update(page_type.page_handlers())</span></div><div><br/></div><div>index.py -&gt; handler() -&gt; <span style="font-family: &quot;맑은 고딕&quot;;">modules.load_all_plugins() -&gt; execfile() -&gt; plugins/pages/</span><span style="font-family: &quot;맑은 고딕&quot;;">shipped.pagehandlers[] -&gt; side : sidebar.page_side -&gt;</span> <span style="color: rgb(255, 0, 0); font-family: &quot;맑은 고딕&quot;;">sidebar.py</span><span style="font-family: &quot;맑은 고딕&quot;;"> 파일의 page_side()</span></div><div><br/></div><div><span style="font-weight: bold;">n. 호출한 </span><span style="font-weight: bold;">URL 을 </span><span style="font-weight: bold;">plugins/pages/shipped.py 에서 찼는다. URL 과 page handler 사이를 맵핑한 딕셔너리</span></div><div><span style="font-family: &quot;맑은 고딕&quot;;">modules.load_all_plugins() -&gt; exec()  (import 와 달리 plugin 파일을 실행시킨다, Debug 할때 주의하자)</span></div><div><span style="font-weight: bold;"><span style="font-weight: bold; color: rgb(255, 0, 0);">/omd/sites/sjopen/share/check_mk/web/plugins/pages/shipped.py</span>  </span><span style="font-weight: bold;">  -&gt; </span><span style="font-weight: bold;">Import modules that contain the page functions</span></div><div><span style="font-family: 굴림체; font-weight: bold;">    pagehandlers.update({     ==&gt;  </span><span style="font-weight: bold;">URL 을 key 로 page rendering 가 저장되어 있음</span></div><div><span style="font-family: 굴림체; font-weight: bold;">       &quot;index&quot;      : main.page_index,          ==&gt; main.py 파일의 </span><span style="font-family: 굴림체; font-weight: bold;">page_index()</span></div><div><span style="font-family: 굴림체; font-weight: bold;">       </span><span style="font-family: 굴림체; font-weight: bold;">&quot;side&quot;       : sidebar.page_side,        ==&gt; </span><span style="font-family: 굴림체; font-weight: bold;">sidebar.py 파일의 </span><span style="font-family: 굴림체; font-weight: bold;">page_side()</span></div><div><span style="font-family: 굴림체; font-weight: bold;">       </span><span style="font-family: 굴림체; font-weight: bold;">&quot;dashboard&quot;  : dashboard.page_dashboard, ==&gt; dashboard.py 파일의 </span><span style="font-family: 굴림체; font-weight: bold;">page_dashboard()</span></div><div><span style="font-family: 굴림체; font-weight: bold;">       </span><span style="font-family: 굴림체; font-weight: bold;">&quot;view&quot;       : views.page_view,</span></div><div><br/></div><div><span style="font-family: 바탕체; font-weight: bold;"> </span><span style="font-family: 바탕체; font-weight: bold;"><img src="URL_to_page_handlers_mapping_files/Image.png" type="image/png" data-filename="Image.png" width="792"/></span></div><div><span style="font-weight: bold;">/omd/sites/sjopen/share/check_mk/web/plugins/sidebar/shipped.py</span></div><div><span style="font-weight: bold;">/omd/sites/sjopen/share/check_mk/web/plugins/sidebar/</span><span style="font-weight: bold;">wato.py</span></div><div><span style="font-weight: bold;">/omd/sites/sjopen/share/check_mk/web/plugins/sidebar/</span><span style="font-weight: bold;">search.py</span></div><div><span style="font-weight: bold;">/omd/sites/sjopen/share/check_mk/web/plugins/sidebar/</span><span style="font-weight: bold;">nagvis_maps.py</span></div><div><span style="font-weight: bold;">/omd/sites/sjopen/share/check_mk/web/plugins/sidebar/</span><span style="font-weight: bold;">mkeventd.py</span></div><div><span style="font-weight: bold;">/omd/sites/sjopen/share/check_mk/web/plugins/sidebar/</span><span style="font-weight: bold;">bi.py</span></div><div><br/></div><div><span style="font-family: &quot;맑은 고딕&quot;; font-weight: bold;">n. side.py 의 핸들러인 sidebar.py 에서 </span><span style="font-family: &quot;맑은 고딕&quot;; font-weight: bold;">html.html_head(_(&quot;Check_MK Sidebar&quot;) 구현 확인</span></div><div>/omd/sites/sjopen/share/check_mk/web/htdocs/sidebar.py</div><div>def heading(text):</div><div>def sidebar_head():</div><div>def render_messages():</div><div>def sidebar_foot():</div><div>def page_side():</div><div>    if not config.user.may(&quot;general.see_sidebar&quot;):</div><div>    if config.sidebar_notify_interval is not None:</div><div>        interval = config.sidebar_notify_interval</div><div>    html.html_head(_(&quot;<span style="color: rgb(255, 0, 0);">Check_MK Sidebar</span>&quot;), javascripts=[&quot;sidebar&quot;], stylesheets=[&quot;sidebar&quot;, &quot;status&quot;])</div><div>    html.write('&lt;body class=&quot;<span style="color: rgb(255, 0, 0);">side</span>')</div><div><br/></div><div><span style="font-weight: bold;">n. 우측 상단의 Check_MK Log 제거하기</span></div><div><span style="font-weight: bold;">- 이미지를 출력하지 않도록 html.img 메소드를 삭제하면 Log가 사라진다.</span></div><div>- html.write() 메소드로 원하는 HTML TAG 추가하며 원하는 내용이 출력된다.</div><div>def sidebar_head():</div><div>    html.open_div(id_=&quot;side_header&quot;)</div><div>    html.div('', id_=&quot;side_fold&quot;)</div><div>    html.open_a(href=config.user.get_attribute(&quot;start_url&quot;) or config.start_url,</div><div>                target=&quot;main&quot;, title=_(&quot;Go to main overview&quot;))</div><div>    ######### html.img(src=&quot;images/sidebar_top.png&quot;, id_=&quot;side_bg&quot;)</div><div>    html.write(&quot;&lt;h1&gt;This is KTS NIS&lt;/h1&gt;&quot;)  # 테스트로 추가한 내용</div><div>    html.open_div(id_=&quot;side_version&quot;)</div><div>    html.open_a(href=&quot;version.py&quot;, target=&quot;main&quot;, title=_(&quot;Open release notes&quot;))</div><div>    html.write(get_check_mk_edition_title())</div><div>    html.br()</div><div>    html.write(cmk.__version__)</div><div><br/></div><div>    if werks.may_acknowledge():</div><div>        num_unacknowledged_werks = werks.num_unacknowledged_incompatible_werks()</div><div>        if num_unacknowledged_werks:</div><div>            html.span(num_unacknowledged_werks, class_=&quot;unack_werks&quot;,</div><div>                      title=_(&quot;%d unacknowledged incompatible werks&quot;) % num_unacknowledged_werks)</div><div>    html.close_a()</div><div>    html.close_div()</div><div>    html.close_a()</div><div>    html.close_div()</div><div><br/></div><div><img src="URL_to_page_handlers_mapping_files/Image [1].png" type="image/png" data-filename="Image.png" width="220"/> <img src="URL_to_page_handlers_mapping_files/Image [2].png" type="image/png" data-filename="Image.png" width="231"/></div><div><br/></div><div><br/></div><div>n. <span style="font-weight: bold;">shipped.py 플러그인 모듈에 정의된 tacticaloverview 살펴보기</span></div><div><span style="font-weight: bold;"><img src="URL_to_page_handlers_mapping_files/Image [3].png" type="image/png" data-filename="Image.png"/></span></div><div>/omd/sites/sjopen/share/check_mk/web/plugins/sidebar/shipped.py</div><div><br/></div><div><span style="font-family: 바탕체;">sidebar_snapins[&quot;tactical_overview&quot;] = {</span></div><div><span style="font-family: 바탕체;">    &quot;title&quot; : _(&quot;Tactical Overview&quot;),</span></div><div><span style="font-family: 바탕체;">    &quot;description&quot; : _(&quot;The total number of hosts and service with and without problems&quot;),</span></div><div><span style="font-family: 바탕체;">    &quot;refresh&quot; : True,</span></div><div><span style="font-family: 바탕체;">    &quot;render&quot; : render_tactical_overview,</span></div><div><span style="font-family: 바탕체;">    &quot;allowed&quot; : [ &quot;user&quot;, &quot;admin&quot;, &quot;guest&quot; ],</span></div><div><span style="font-family: 바탕체;">    &quot;styles&quot; : snapin_tactical_overview_styles,</span></div><div><span style="font-family: 바탕체;">}</span></div><div><br/></div><div><span style="font-family: 바탕체;">def render_tactical_overview(extra_filter_headers=&quot;&quot;, extra_url_variables=None):</span></div><div><span style="font-family: 바탕체;">......</span></div><div><span style="font-family: 바탕체;">sidebar_snapins[&quot;tactical_overview&quot;] = {</span></div><div><span style="font-family: 바탕체;">    &quot;title&quot; : _(&quot;Tactical Overview&quot;),</span></div><div><span style="font-family: 바탕체;">    &quot;description&quot; : _(&quot;The total number of hosts and service with and without problems&quot;),</span></div><div><span style="font-family: 바탕체;">    &quot;refresh&quot; : True,</span></div><div><span style="font-family: 바탕체;">    &quot;render&quot; : render_tactical_overview,</span></div><div><span style="font-family: 바탕체;">    &quot;allowed&quot; : [ &quot;user&quot;, &quot;admin&quot;, &quot;guest&quot; ],</span></div><div><span style="font-family: 바탕체;">    &quot;styles&quot; : snapin_tactical_overview_styles,</span></div><div><span style="font-family: 바탕체;">....</span></div><div><span style="font-family: 바탕체;">html.open_table(class_=[&quot;content_center&quot;, &quot;tacticaloverview&quot;], cellspacing=2, cellpadding=0, border=0)</span></div><div><span style="font-family: 바탕체;">....</span></div><div><span style="font-family: 바탕체;">for row in rows:</span></div><div><span style="font-family: 바탕체;">    if row[&quot;what&quot;] == &quot;event&quot;:</span></div><div><span style="font-family: 바탕체;">        amount, problems, unhandled_problems = row[&quot;data&quot;]</span></div><div><span style="font-family: 바탕체;">        stales = 0</span></div><div><span style="font-family: 바탕체;">        # no events open and disabled in local site: don't show events</span></div><div><span style="font-family: 바탕체;">        if amount == 0 and not config.mkeventd_enabled:</span></div><div><span style="font-family: 바탕체;">            continue</span></div><div><span style="font-family: 바탕체;">    else:</span></div><div><span style="font-family: 바탕체;">        amount, problems, unhandled_problems, stales = row[&quot;data&quot;]</span></div><div><span style="font-family: 바탕체;">    html.open_tr()</span></div><div><span style="font-family: 바탕체;">    html.th(row[&quot;title&quot;])</span></div><div><span style="font-family: 바탕체;">    html.th(_(&quot;Problems&quot;))</span></div><div><span style="font-family: 바탕체;">    html.th(_(&quot;Unhandled&quot;))</span></div><div><span style="font-family: 바탕체;">    if td_class == 'col4':</span></div><div><span style="font-family: 바탕체;">        html.th(_(&quot;Stale&quot;))</span></div><div><span style="font-family: 바탕체;">    html.close_tr()</span></div><div><span style="font-family: 바탕체;">    html.open_tr()</span></div><div><span style="font-family: 바탕체;">    url = html.makeuri_contextless(row[&quot;views&quot;][&quot;all&quot;] + extra_url_variables,filename=&quot;view.py&quot;)</span></div><div><span style="font-family: 바탕체;">    html.open_td(class_=[&quot;total&quot;, td_class])</span></div><div><span style="font-family: 바탕체;">    html.a(amount, href=url, target=&quot;main&quot;)</span></div><div><span style="font-family: 바탕체;">    html.close_td()</span></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">n. view.py 에 대한 분석</span></div><div><br/></div><div><span style="font-family: &quot;맑은 고딕&quot;;">- view 요청에 대한 헨들러인 page_view 를 분석해보자.</span></div><div><span style="font-family: &quot;맑은 고딕&quot;;">- plugin 초기화를 과정에서 여러 종류의 딕셔너리 데이터들이 선언된다. </span></div><div><span style="font-family: &quot;맑은 고딕&quot;;">   /omd/sites/sjopen/share/check_mk/web/plugins/views/datasources.py</span></div><div><br/></div><div><br/></div><div><span style="font-family: 굴림체; font-weight: bold;">&quot;view&quot;       : views.page_view</span></div><div><br/></div><div><span style="font-family: 바탕체;">def page_view():</span></div><div><span style="font-family: 바탕체;">    bi.reset_cache_status() # needed for status icon</span></div><div><br/></div><div><span style="font-family: 바탕체;">    load_views()</span></div><div><span style="font-family: 바탕체;">    view_name = html.var(&quot;view_name&quot;)</span></div><div><span style="font-family: 바탕체;">    if view_name == None:</span></div><div><span style="font-family: 바탕체;">        raise MKGeneralException(_(&quot;Missing the variable view_name in the URL.&quot;))</span></div><div><span style="font-family: 바탕체;">    view = available_views.get(view_name)</span></div><div><span style="font-family: 바탕체;">    if not view:</span></div><div><span style="font-family: 바탕체;">        raise MKGeneralException(_(&quot;No view defined with the name '%s'.&quot;) % html.attrencode(view_name))</span></div><div><br/></div><div><span style="font-family: 바탕체;">    # Gather the page context which is needed for the &quot;add to visual&quot; popup menu</span></div><div><span style="font-family: 바탕체;">    # to add e.g. views to dashboards or reports</span></div><div><span style="font-family: 바탕체;">    datasource = multisite_datasources[view['datasource']]</span></div><div><span style="font-family: 바탕체;">    context = visuals.get_context_from_uri_vars(datasource['infos'])</span></div><div><span style="font-family: 바탕체;">    context.update(visuals.get_singlecontext_html_vars(view))</span></div><div><span style="font-family: 바탕체;">    html.set_page_context(context)</span></div><div><br/></div><div><span style="font-family: 바탕체;">    prepare_painter_options(view_name)</span></div><div><span style="font-family: 바탕체;">    painter_options.update_from_url(view)</span></div><div><br/></div><div><span style="font-family: 바탕체;">    show_view(view, True, True, True)</span></div><div><br/></div><div><br/></div><div><span style="font-family: 바탕체;"># Load all views - users or builtins</span></div><div><span style="font-family: 바탕체;">def load_views():</span></div><div><span style="font-family: 바탕체;">    global multisite_views, available_views</span></div><div><span style="font-family: 바탕체;">    # Skip views which do not belong to known datasources</span></div><div><span style="font-family: 바탕체;">    multisite_views = visuals.load('views', multisite_builtin_views,</span></div><div><span style="font-family: 바탕체;">                    skip_func = lambda v: v['datasource'] not in multisite_datasources)</span></div><div><span style="font-family: 바탕체;">    available_views = visuals.available('views', multisite_views)</span></div><div><span style="font-family: 바탕체;">    transform_old_views()</span></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 